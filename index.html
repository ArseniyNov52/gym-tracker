<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GymFlow - –¢—Ä–µ–∫–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RH1WWR3XTP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RH1WWR3XTP');
  </script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e3f2fd 50%, #f5f7fa 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #e2e8f0;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    
    .header-content {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 0.75rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
      gap: 0.5rem;
    }
    
    @media (min-width: 640px) {
      .header-content {
        padding: 0 1rem;
        height: 64px;
      }
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-shrink: 0;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    @media (min-width: 640px) {
      .logo-icon {
        width: 40px;
        height: 40px;
        font-size: 24px;
        border-radius: 12px;
      }
    }
    
    .logo-text h1 {
      font-size: 1rem;
      font-weight: 700;
      color: #0f172a;
    }
    
    @media (min-width: 640px) {
      .logo-text h1 {
        font-size: 1.25rem;
      }
    }
    
    .logo-text p {
      display: none;
      font-size: 0.75rem;
      color: #64748b;
    }
    
    @media (min-width: 400px) {
      .logo-text p {
        display: block;
      }
    }
    
    .timer-display {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      padding: 0.375rem 0.75rem;
      border-radius: 8px;
      border: 1px solid #6ee7b7;
    }
    
    @media (min-width: 640px) {
      .timer-display {
        padding: 0.5rem 1rem;
        border-radius: 12px;
      }
    }
    
    .timer-icon {
      font-size: 16px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .timer-text {
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      font-weight: 600;
      color: #047857;
    }
    
    @media (min-width: 640px) {
      .timer-text {
        font-size: 1.125rem;
      }
    }
    
    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1rem 0.75rem;
    }
    
    @media (min-width: 640px) {
      .container {
        padding: 2rem 1rem;
      }
    }
    
    .nav {
      margin-bottom: 1rem;
    }
    
    @media (min-width: 640px) {
      .nav {
        margin-bottom: 2rem;
      }
    }
    
    .nav-buttons {
      background: white;
      border-radius: 16px;
      padding: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .nav-buttons::-webkit-scrollbar {
      display: none;
    }
    
    .nav-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
      background: transparent;
      color: #64748b;
      flex-shrink: 0;
    }
    
    .nav-btn:hover {
      background: #f8fafc;
      color: #0f172a;
    }
    
    .nav-btn.active {
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .card {
      background: white;
      border-radius: 16px;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
      margin-bottom: 1rem;
    }
    
    @media (min-width: 640px) {
      .card {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
    }
    
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    @media (min-width: 640px) {
      .card-header {
        margin-bottom: 1.5rem;
      }
    }
    
    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #0f172a;
    }
    
    @media (min-width: 640px) {
      .card-title {
        font-size: 1.5rem;
      }
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 44px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .btn-primary:hover {
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
      transform: translateY(-1px);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
      color: white;
    }
    
    .btn-secondary {
      background: #f1f5f9;
      color: #475569;
    }
    
    .btn-danger {
      background: #fee2e2;
      color: #dc2626;
    }

    /* <CHANGE> –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã */
    .btn-warning {
      background: #fff7ed;
      color: #ea580c;
      border: 1px solid #fb923c;
    }

    .btn-warning:hover {
      background: #ffedd5;
    }
    /* </CHANGE> */
    
    .btn-large {
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
    }
    
    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      color: #64748b;
    }
    
    @media (min-width: 640px) {
      .empty-state {
        padding: 3rem;
      }
    }
    
    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    @media (min-width: 640px) {
      .empty-icon {
        font-size: 4rem;
      }
    }
    
    .empty-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 0.5rem;
    }
    
    @media (min-width: 640px) {
      .empty-title {
        font-size: 1.25rem;
      }
    }
    
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
    }
    
    @media (min-width: 640px) {
      .modal-overlay {
        padding: 1rem;
      }
    }
    
    .modal {
      background: white;
      border-radius: 16px;
      max-width: 42rem;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid #e2e8f0;
    }
    
    @media (min-width: 640px) {
      .modal-header {
        padding: 1.5rem;
      }
    }
    
    .modal-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: #0f172a;
    }
    
    @media (min-width: 640px) {
      .modal-title {
        font-size: 1.25rem;
      }
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #94a3b8;
      transition: color 0.2s;
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-close:hover {
      color: #475569;
    }
    
    .modal-body {
      padding: 1rem;
      overflow-y: auto;
      max-height: calc(90vh - 72px);
    }
    
    @media (min-width: 640px) {
      .modal-body {
        padding: 1.5rem;
        max-height: calc(90vh - 88px);
      }
    }
    
    .input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
      min-height: 44px;
    }
    
    .input:focus {
      outline: none;
      border-color: #2563eb;
    }
    
    .label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #475569;
      margin-bottom: 0.5rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    @media (min-width: 640px) {
      .form-group {
        margin-bottom: 1.5rem;
      }
    }
    
    .stat-card {
      background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
    }
    
    @media (min-width: 640px) {
      .stat-card {
        padding: 1.25rem;
      }
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-bottom: 0.75rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    @media (min-width: 640px) {
      .stat-icon {
        width: 48px;
        height: 48px;
        font-size: 24px;
        border-radius: 12px;
      }
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #0f172a;
      margin-bottom: 0.25rem;
    }
    
    @media (min-width: 640px) {
      .stat-value {
        font-size: 2rem;
      }
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: #64748b;
    }
    
    .grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: 1fr;
    }
    
    @media (min-width: 480px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (min-width: 768px) {
      .grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }
    
    .exercise-item {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      transition: border-color 0.2s;
    }
    
    @media (min-width: 640px) {
      .exercise-item {
        padding: 1.25rem;
      }
    }
    
    .exercise-item:hover {
      border-color: #93c5fd;
    }
    
    .set-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      gap: 0.5rem;
    }
    
    .chart-container {
      background: #f8fafc;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    @media (min-width: 640px) {
      .chart-container {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
    }
    
    .chart-title {
      font-size: 1rem;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 0.75rem;
    }
    
    @media (min-width: 768px) {
      .chart-title {
        font-size: 1.125rem;
        margin-bottom: 1rem;
      }
    }
    
    .achievement-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    @media (min-width: 480px) {
      .achievement-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (min-width: 768px) {
      .achievement-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }
    
    .achievement-card {
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      transition: all 0.2s;
    }
    
    @media (min-width: 640px) {
      .achievement-card {
        padding: 1.25rem;
      }
    }
    
    .achievement-card.unlocked {
      border-color: #93c5fd;
      background: #eff6ff;
    }
    
    .achievement-card.locked {
      opacity: 0.6;
      filter: grayscale(100%);
    }
    
    .achievement-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }
    
    @media (min-width: 640px) {
      .achievement-icon {
        font-size: 3rem;
      }
    }
    
    .achievement-title {
      font-weight: 700;
      font-size: 1.125rem;
      color: #0f172a;
      margin-bottom: 0.25rem;
    }
    
    .achievement-desc {
      font-size: 0.875rem;
      color: #64748b;
    }
    
    .counter {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .counter-btn {
      width: 44px;
      height: 44px;
      background: #f1f5f9;
      border: none;
      border-radius: 8px;
      font-size: 1.25rem;
      font-weight: 700;
      color: #475569;
      cursor: pointer;
      transition: background 0.2s;
      flex-shrink: 0;
    }
    
    @media (min-width: 640px) {
      .counter-btn {
        width: 48px;
        height: 48px;
      }
    }
    
    .counter-btn:hover {
      background: #e2e8f0;
    }

    /* <CHANGE> –£–≤–µ–ª–∏—á–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ —Å—Ç—Ä–µ–ª–æ–∫ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
    .counter-btn-large {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      border: none;
      border-radius: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .counter-btn-large:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    .counter-btn-large:active {
      transform: scale(0.95);
    }
    /* </CHANGE> */
    
    .counter-input {
      flex: 1;
      text-align: center;
      font-size: 1.25rem;
      font-weight: 700;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 0.625rem;
      min-height: 44px;
    }
    
    @media (min-width: 640px) {
      .counter-input {
        font-size: 1.5rem;
        padding: 0.75rem;
      }
    }
    
    .mood-selector {
      display: flex;
      gap: 0.75rem;
    }
    
    .mood-btn {
      flex: 1;
      padding: 1rem;
      font-size: 2rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .mood-btn.selected {
      border-color: #2563eb;
      background: #eff6ff;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    const exerciseDatabase = {
      '–ì—Ä—É–¥—å': ['–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞','–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –Ω–∞–∫–ª–æ–Ω–Ω–æ–π —Å–∫–∞–º—å–µ','–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –ª–µ–∂–∞','–†–∞–∑–≤–æ–¥–∫–∞ –≥–∞–Ω—Ç–µ–ª–µ–π –ª–µ–∂–∞','–û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞','–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ ¬´–ë–∞–±–æ—á–∫–∞¬ª','–ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã'],
      '–°–ø–∏–Ω–∞': ['–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è','–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞','–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ','–¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏','–ì–∏–ø–µ—Ä—ç–∫—Å—Ç–µ–Ω–∑–∏—è','–®—Ä–∞–≥–∏ —Å–æ —à—Ç–∞–Ω–≥–æ–π'],
      '–ù–æ–≥–∏': ['–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π','–ñ–∏–º –Ω–æ–≥–∞–º–∏','–í—ã–ø–∞–¥—ã —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏','–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–æ–≥ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ','–°–≥–∏–±–∞–Ω–∏—è –Ω–æ–≥ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ','–ü–æ–¥—ä–µ–º—ã –Ω–∞ –Ω–æ—Å–∫–∏'],
      '–ü–ª–µ—á–∏': ['–ê—Ä–º–µ–π—Å–∫–∏–π –∂–∏–º','–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π —Å–∏–¥—è','–ú–∞—Ö–∏ –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω—ã','–ú–∞—Ö–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ','–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É'],
      '–ë–∏—Ü–µ–ø—Å': ['–ü–æ–¥—ä–µ–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –±–∏—Ü–µ–ø—Å','–ü–æ–¥—ä–µ–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –±–∏—Ü–µ–ø—Å','–°–≥–∏–±–∞–Ω–∏—è ¬´–º–æ–ª–æ—Ç¬ª','–°–≥–∏–±–∞–Ω–∏—è –Ω–∞ —Å–∫–∞–º—å–µ –°–∫–æ—Ç—Ç–∞'],
      '–¢—Ä–∏—Ü–µ–ø—Å': ['–ñ–∏–º –ª–µ–∂–∞ —É–∑–∫–∏–º —Ö–≤–∞—Ç–æ–º','–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º','–†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–ª–æ–∫–µ','–û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –±—Ä—É—Å—å—è—Ö'],
      '–ü—Ä–µ—Å—Å': ['–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è','–ü–æ–¥—ä–µ–º –Ω–æ–≥ –≤ –≤–∏—Å–µ','–ú–æ–ª–∏—Ç–≤–∞ –Ω–∞ –±–ª–æ–∫–µ']
    };

    const ACHIEVEMENT_CATEGORIES = [
      {name: '–ü–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ', achievements: [
        {id: 'c1', title: '–ù–æ–≤–∏—á–æ–∫', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 1 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: 'üå±'},
        {id: 'c10', title: '–ü—Ä–∏–≤—ã—á–∫–∞', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 10 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', icon: 'üí™'},
        {id: 'c50', title: '–†–∞–±–æ—Ç—è–≥–∞', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 50 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', icon: 'üî•'},
        {id: 'c100', title: '–í–µ—Ç–µ—Ä–∞–Ω –∑–∞–ª–∞', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 100 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', icon: 'üèÜ'},
        {id: 'c200', title: '–ñ–µ–ª–µ–∑–Ω–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 200 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', icon: '‚ö°'},
        {id: 'c400', title: '–ú–∞—Å—Ç–µ—Ä —Ç—Ä–µ–Ω–∞–∂—ë—Ä–Ω–æ–≥–æ –∑–∞–ª–∞', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 400 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', icon: 'üî±'},
        {id: 'c800', title: '–õ–µ–≥–µ–Ω–¥–∞ —Å–ø–æ—Ä—Ç–∞', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 800 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', icon: 'üëë'}
      ]},
      {name: '–í–µ—Å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö', achievements: [
        {id: 'v1t', title: '–ü–µ—Ä–≤–∞—è —Ç–æ–Ω–Ω–∞', description: '–ü–æ–¥–Ω—è—Ç—å >1 —Ç –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: 'üèãÔ∏è'},
        {id: 'v2t', title: '–î–≤–æ–π–Ω–∞—è —Å–∏–ª–∞', description: '–ü–æ–¥–Ω—è—Ç—å >2 —Ç –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: 'üí™'},
        {id: 'v5t', title: '–°–∏–ª–∞—á', description: '–ü–æ–¥–Ω—è—Ç—å >5 —Ç –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: 'ü¶¨'},
        {id: 'v10t', title: '–¢–∏—Ç–∞–Ω', description: '–ü–æ–¥–Ω—è—Ç—å >10 —Ç –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: '‚ö°'},
        {id: 'v20t', title: '–ì–µ—Ä–∫—É–ª–µ—Å', description: '–ü–æ–¥–Ω—è—Ç—å >20 —Ç –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: 'üî•'},
        {id: 'v40t', title: '–°–≤–µ—Ä—Ö—á–µ–ª–æ–≤–µ–∫', description: '–ü–æ–¥–Ω—è—Ç—å >40 —Ç –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', icon: 'üíé'}
      ]},
      {name: '–û–±—â–∏–π –ø–æ–¥–Ω—è—Ç—ã–π –≤–µ—Å', achievements: [
        {id: 't50t', title: '–ù–∞—á–∏–Ω–∞—é—â–∏–π –∞—Ç–ª–µ—Ç', description: '–û–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂ >50 —Ç', icon: 'üéØ'},
        {id: 't100t', title: '–¢–æ–Ω–Ω—ã–π –∫–ª—É–±', description: '–û–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂ >100 —Ç', icon: 'üè≠'},
        {id: 't250t', title: '–°—Ç–∞–ª—å–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä', description: '–û–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂ >250 —Ç', icon: 'üî®'},
        {id: 't500t', title: '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Ç–µ–ª–∞', description: '–û–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂ >500 —Ç', icon: 'üèõÔ∏è'},
        {id: 't1000t', title: '–ü–æ–∫–æ—Ä–∏—Ç–µ–ª—å –≤–µ—Ä—à–∏–Ω', description: '–û–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂ >1000 —Ç', icon: 'üèîÔ∏è'}
      ]},
      {name: '–ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤ –∑–∞–ª–µ', achievements: [
        {id: 'time5h', title: '–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏', description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ >5 —á–∞—Å–æ–≤ –≤ –∑–∞–ª–µ', icon: '‚è±Ô∏è'},
        {id: 'time20h', title: '–ó–∞–≤—Å–µ–≥–¥–∞—Ç–∞–π', description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ >20 —á–∞—Å–æ–≤ –≤ –∑–∞–ª–µ', icon: 'üïê'},
        {id: 'time50h', title: '–ü—Ä–µ–¥–∞–Ω–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å—É', description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ >50 —á–∞—Å–æ–≤ –≤ –∑–∞–ª–µ', icon: '‚è∞'},
        {id: 'time100h', title: '–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü', description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ >100 —á–∞—Å–æ–≤ –≤ –∑–∞–ª–µ', icon: '‚åö'},
        {id: 'time250h', title: '–•—Ä–∞–º —Å–∏–ª—ã', description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ >250 —á–∞—Å–æ–≤ –≤ –∑–∞–ª–µ', icon: 'üèõÔ∏è'},
        {id: 'time500h', title: '–ñ–µ–ª–µ–∑–Ω–∞—è –∂–∏–∑–Ω—å', description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ >500 —á–∞—Å–æ–≤ –≤ –∑–∞–ª–µ', icon: 'üí´'}
      ]}
    ];


    function App() {
      const [activeTab, setActiveTab] = useState('workout');
      const [exercises, setExercises] = useState([]);
      const [workouts, setWorkouts] = useState([]);
      const [templates, setTemplates] = useState([]);
      const [currentWorkout, setCurrentWorkout] = useState(null);
      const [timerSeconds, setTimerSeconds] = useState(0);
      const [isTimerRunning, setIsTimerRunning] = useState(false);
      const [unlockedAchievements, setUnlockedAchievements] = useState([]);
      const [goals, setGoals] = useState([]);

      useEffect(() => {
        const initExercises = [];
        let id = 1;
        for (const [group, exList] of Object.entries(exerciseDatabase)) {
          exList.forEach(name => initExercises.push({ id: id++, name, group, system: true }));
        }
        
        const saved = localStorage.getItem('gym_exercises');
        if (saved) {
          const userExercises = JSON.parse(saved).filter(ex => !ex.system);
          userExercises.forEach(ex => initExercises.push({ ...ex, id: id++ }));
        }
        
        setExercises(initExercises);
        
        const savedWorkouts = localStorage.getItem('gym_workouts');
        if (savedWorkouts) setWorkouts(JSON.parse(savedWorkouts));
        
        const savedTemplates = localStorage.getItem('gym_templates');
        if (savedTemplates) setTemplates(JSON.parse(savedTemplates));

        const savedAchievements = localStorage.getItem('gym_achievements');
        if (savedAchievements) setUnlockedAchievements(JSON.parse(savedAchievements));
        
        const savedGoals = localStorage.getItem('gym_goals');
        if (savedGoals) setGoals(JSON.parse(savedGoals));
      }, []);

      useEffect(() => {
        let interval;
        if (isTimerRunning && currentWorkout) {
          interval = setInterval(() => {
            setTimerSeconds(s => s + 1);
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [isTimerRunning, currentWorkout]);

      useEffect(() => {
        localStorage.setItem('gym_exercises', JSON.stringify(exercises.filter(e => !e.system)));
        localStorage.setItem('gym_workouts', JSON.stringify(workouts));
        localStorage.setItem('gym_templates', JSON.stringify(templates));
        localStorage.setItem('gym_achievements', JSON.stringify(unlockedAchievements));
        localStorage.setItem('gym_goals', JSON.stringify(goals));
      }, [exercises, workouts, templates, unlockedAchievements, goals]);

      const formatTime = (seconds) => {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
      };

      const startNewWorkout = () => {
        const workout = {
          id: Date.now(),
          startDate: new Date().toISOString(),
          endDate: null,
          templateName: '–°–≤–æ–±–æ–¥–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
          bodyWeightBefore: null,
          bodyWeightAfter: null,
          overallMood: null,
          notes: '',
          exercises: []
        };
        setCurrentWorkout(workout);
        setIsTimerRunning(true);
        setTimerSeconds(0);
      };

      const startFromTemplate = (templateId) => {
        const template = templates.find(t => t.id === templateId);
        if (!template) return;

        const workout = {
          id: Date.now(),
          startDate: new Date().toISOString(),
          endDate: null,
          templateName: template.name,
          bodyWeightBefore: null,
          bodyWeightAfter: null,
          overallMood: null,
          notes: '',
          exercises: template.exercises.map(ex => ({
            exerciseId: ex.exerciseId,
            exerciseName: ex.exerciseName,
            sets: [],
            restTime: ex.restTime
          }))
        };
        setCurrentWorkout(workout);
        setIsTimerRunning(true);
        setTimerSeconds(0);
        setActiveTab('workout');
      };

      /* <CHANGE> –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */
      const cancelWorkout = () => {
        if (!currentWorkout) return;
        
        if (confirm('‚ö†Ô∏è –û—Ç–º–µ–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?\n\n–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã. –í—ã —É–≤–µ—Ä–µ–Ω—ã?')) {
          setCurrentWorkout(null);
          setIsTimerRunning(false);
          setTimerSeconds(0);
          alert('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞');
        }
      };
      /* </CHANGE> */

      const checkAndUnlockAchievements = (lastWorkout) => {
        const getWorkoutVolume = (w) => 
          w.exercises.reduce((s, e) => s + e.sets.reduce((a, st) => a + st.weight * st.reps, 0), 0);
        
        const getTotalVolume = (ww) => 
          ww.reduce((t, w) => t + getWorkoutVolume(w), 0);

        const getTotalHours = (ww) => {
          const totalMs = ww.reduce((sum, w) => w.endDate ? sum + (new Date(w.endDate).getTime() - new Date(w.startDate).getTime()) : sum, 0);
          return totalMs / 3600000;
        };

        const lastVolume = getWorkoutVolume(lastWorkout);
        const totalVol = getTotalVolume(workouts);
        const totalHours = getTotalHours(workouts);

        const checks = [
          { id: 'c1', condition: workouts.length >= 1 },
          { id: 'c10', condition: workouts.length >= 10 },
          { id: 'c50', condition: workouts.length >= 50 },
          { id: 'c100', condition: workouts.length >= 100 },
          { id: 'c200', condition: workouts.length >= 200 },
          { id: 'c400', condition: workouts.length >= 400 },
          { id: 'c800', condition: workouts.length >= 800 },
          { id: 'v1t', condition: lastVolume > 1000 },
          { id: 'v2t', condition: lastVolume > 2000 },
          { id: 'v5t', condition: lastVolume > 5000 },
          { id: 'v10t', condition: lastVolume > 10000 },
          { id: 'v20t', condition: lastVolume > 20000 },
          { id: 'v40t', condition: lastVolume > 40000 },
          { id: 't50t', condition: totalVol > 50000 },
          { id: 't100t', condition: totalVol > 100000 },
          { id: 't250t', condition: totalVol > 250000 },
          { id: 't500t', condition: totalVol > 500000 },
          { id: 't1000t', condition: totalVol > 1000000 },
          { id: 'time5h', condition: totalHours > 5 },
          { id: 'time20h', condition: totalHours > 20 },
          { id: 'time50h', condition: totalHours > 50 },
          { id: 'time100h', condition: totalHours > 100 },
          { id: 'time250h', condition: totalHours > 250 },
          { id: 'time500h', condition: totalHours > 500 }
        ];

        const newly = [];
        checks.forEach(check => {
          if (!unlockedAchievements.includes(check.id) && check.condition) {
            newly.push(check.id);
          }
        });

        if (newly.length > 0) {
          setUnlockedAchievements([...unlockedAchievements, ...newly]);
          const achievementNames = newly.map(id => {
            for (const cat of ACHIEVEMENT_CATEGORIES) {
              const ach = cat.achievements.find(a => a.id === id);
              if (ach) return ach.title;
            }
            return '';
          }).filter(Boolean);
          
          setTimeout(() => {
            alert(`üéâ –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!\n\n${achievementNames.join(', ')}`);
          }, 500);
        }
      };

      const finishWorkout = () => {
        if (!currentWorkout) return;
        
        const filtered = currentWorkout.exercises.filter(e => e.sets.length > 0);
        if (filtered.length === 0) {
          alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
          return;
        }

        /* <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ü–µ–Ω–∫–∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è */
        const mood = prompt('–û—Ü–µ–Ω–∏—Ç–µ –æ–±—â–µ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:\n1 - –ü–ª–æ—Ö–æ üò´\n2 - –ù–æ—Ä–º–∞–ª—å–Ω–æ üòê\n3 - –û—Ç–ª–∏—á–Ω–æ üòÑ', '2');
        const overallMood = mood ? Math.min(3, Math.max(1, parseInt(mood) || 2)) : 2;
        /* </CHANGE> */

        const notes = prompt('–î–æ–±–∞–≤—å—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ (–æ—â—É—â–µ–Ω–∏—è, –±–æ–ª–∏, –∏–¥–µ–∏):', '');

        const finished = {
          ...currentWorkout,
          exercises: filtered,
          endDate: new Date().toISOString(),
          overallMood,
          notes: notes || ''
        };

        const updated = [...workouts, finished];
        setWorkouts(updated);
        
        setIsTimerRunning(false);
        setTimerSeconds(0);
        
        setCurrentWorkout(null);
        
        checkAndUnlockAchievements(finished);
        
        alert('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üí™');
      };

      const exportData = () => {
        const data = {
          exercises: exercises.filter(e => !e.system),
          workouts,
          templates,
          goals,
          exportDate: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `gym-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã! üì•');
      };

      /* <CHANGE> –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö */
      const importData = () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const data = JSON.parse(event.target.result);
              
              if (!data.workouts || !Array.isArray(data.workouts)) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                return;
              }
              
              const confirmMsg = `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ?\n\n` +
                `–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${data.workouts?.length || 0}\n` +
                `–®–∞–±–ª–æ–Ω–æ–≤: ${data.templates?.length || 0}\n` +
                `–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: ${data.exercises?.length || 0}\n` +
                `–¶–µ–ª–µ–π: ${data.goals?.length || 0}\n\n` +
                `‚ö†Ô∏è –≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º!`;
              
              if (!confirm(confirmMsg)) return;
              
              // –ò–º–ø–æ—Ä—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
              if (data.workouts && Array.isArray(data.workouts)) {
                setWorkouts([...workouts, ...data.workouts]);
              }
              
              // –ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–æ–≤
              if (data.templates && Array.isArray(data.templates)) {
                setTemplates([...templates, ...data.templates]);
              }
              
              // –ò–º–ø–æ—Ä—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
              if (data.exercises && Array.isArray(data.exercises)) {
                const userExercises = data.exercises.filter(e => !e.system);
                let maxId = Math.max(...exercises.map(e => e.id), 0);
                const newExercises = userExercises.map(e => ({
                  ...e,
                  id: ++maxId,
                  system: false
                }));
                setExercises([...exercises, ...newExercises]);
              }
              
              // –ò–º–ø–æ—Ä—Ç —Ü–µ–ª–µ–π
              if (data.goals && Array.isArray(data.goals)) {
                setGoals([...goals, ...data.goals]);
              }
              
              alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            } catch (error) {
              alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
            }
          };
          
          reader.readAsText(file);
        };
        
        input.click();
      };
      /* </CHANGE> */

      const resetAllData = () => {
        if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ. –í—ã —É–≤–µ—Ä–µ–Ω—ã?')) return;
        
        if (confirm('–•–æ—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ?')) {
          exportData();
          setTimeout(() => {
            if (confirm('–¢–µ–ø–µ—Ä—å —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
              localStorage.clear();
              window.location.reload();
            }
          }, 1000);
        } else {
          if (confirm('–ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï! –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            localStorage.clear();
            window.location.reload();
          }
        }
      };

      return (
        <div>
          <header className="header">
            <div className="header-content">
              <div className="logo">
                <div className="logo-icon">üí™</div>
                <div className="logo-text">
                  <h1>GymFlow</h1>
                  <p>–¢—Ä–µ–∫–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                </div>
              </div>
              
              {isTimerRunning && (
                <div className="timer-display">
                  <span className="timer-icon">‚è±Ô∏è</span>
                  <span className="timer-text">{formatTime(timerSeconds)}</span>
                </div>
              )}
            </div>
          </header>

          <div className="container">
            <nav className="nav">
              <div className="nav-buttons">
                <button className={`nav-btn ${activeTab === 'workout' ? 'active' : ''}`} onClick={() => setActiveTab('workout')}>
                  <span>üí™</span> –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
                </button>
                <button className={`nav-btn ${activeTab === 'templates' ? 'active' : ''}`} onClick={() => setActiveTab('templates')}>
                  <span>üìÖ</span> –®–∞–±–ª–æ–Ω—ã
                </button>
                <button className={`nav-btn ${activeTab === 'history' ? 'active' : ''}`} onClick={() => setActiveTab('history')}>
                  <span>üìà</span> –ò—Å—Ç–æ—Ä–∏—è
                </button>
                <button className={`nav-btn ${activeTab === 'stats' ? 'active' : ''}`} onClick={() => setActiveTab('stats')}>
                  <span>üìä</span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </button>
                <button className={`nav-btn ${activeTab === 'goals' ? 'active' : ''}`} onClick={() => setActiveTab('goals')}>
                  <span>üéØ</span> –¶–µ–ª–∏
                </button>
                <button className={`nav-btn ${activeTab === 'calendar' ? 'active' : ''}`} onClick={() => setActiveTab('calendar')}>
                  <span>üìÜ</span> –ü–æ—Å–µ—â–µ–Ω–∏—è
                </button>
                <button className={`nav-btn ${activeTab === 'achievements' ? 'active' : ''}`} onClick={() => setActiveTab('achievements')}>
                  <span>üèÜ</span> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                </button>
                <button className={`nav-btn ${activeTab === 'settings' ? 'active' : ''}`} onClick={() => setActiveTab('settings')}>
                  <span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
              </div>
            </nav>

            <main>
              {activeTab === 'workout' && (
                <WorkoutTab
                  currentWorkout={currentWorkout}
                  exercises={exercises}
                  templates={templates}
                  onStartWorkout={startNewWorkout}
                  onFinishWorkout={finishWorkout}
                  onCancelWorkout={cancelWorkout}
                  onUpdateWorkout={setCurrentWorkout}
                />
              )}
              
              {activeTab === 'templates' && (
                <TemplatesTab
                  templates={templates}
                  exercises={exercises}
                  onSaveTemplate={(template) => {
                    if (template.id && templates.find(t => t.id === template.id)) {
                      setTemplates(templates.map(t => t.id === template.id ? template : t));
                    } else {
                      setTemplates([...templates, { ...template, id: Date.now(), createdAt: new Date().toISOString() }]);
                    }
                  }}
                  onDeleteTemplate={(id) => setTemplates(templates.filter(t => t.id !== id))}
                  onStartFromTemplate={startFromTemplate}
                />
              )}
              
              {activeTab === 'history' && (
                <HistoryTab workouts={workouts} exercises={exercises} />
              )}
              
              {activeTab === 'stats' && (
                <StatsTab workouts={workouts} exercises={exercises} />
              )}
              
              {activeTab === 'goals' && (
                <GoalsTab 
                  goals={goals}
                  onSaveGoal={(goal) => {
                    if (goal.id && goals.find(g => g.id === goal.id)) {
                      setGoals(goals.map(g => g.id === goal.id ? goal : g));
                    } else {
                      setGoals([...goals, { ...goal, id: Date.now(), createdAt: new Date().toISOString() }]);
                    }
                  }}
                  onDeleteGoal={(id) => setGoals(goals.filter(g => g.id !== id))}
                />
              )}
              
              {activeTab === 'calendar' && (
                <CalendarTab workouts={workouts} />
              )}
              
              {activeTab === 'achievements' && (
                <AchievementsTab unlockedAchievements={unlockedAchievements} />
              )}
              
              {activeTab === 'settings' && (
                <SettingsTab
                  exercises={exercises}
                  onAddExercise={(name, group) => {
                    const id = Date.now();
                    setExercises([...exercises, { id, name, group: group || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ', system: false }]);
                  }}
                  onDeleteExercise={(id) => {
                    const ex = exercises.find(e => e.id === id);
                    if (ex?.system) {
                      alert('–°–∏—Å—Ç–µ–º–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —É–¥–∞–ª—è—Ç—å –Ω–µ–ª—å–∑—è');
                      return;
                    }
                    const used = templates.some(t => t.exercises.some(e => e.exerciseId === id));
                    if (used) {
                      alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö');
                      return;
                    }
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${ex?.name}¬ª?`)) {
                      setExercises(exercises.filter(e => e.id !== id));
                    }
                  }}
                  onExportData={exportData}
                  onImportData={importData}
                  onResetData={resetAllData}
                />
              )}
            </main>
          </div>
        </div>
      );
    }


    function WorkoutTab({ currentWorkout, exercises, templates, onStartWorkout, onFinishWorkout, onCancelWorkout, onUpdateWorkout }) {
      const [showExerciseModal, setShowExerciseModal] = useState(false);
      const [showSetModal, setShowSetModal] = useState(false);
      const [showBodyWeightModal, setShowBodyWeightModal] = useState(false);
      const [bodyWeightType, setBodyWeightType] = useState('before');
      const [selectedExerciseId, setSelectedExerciseId] = useState(null);
      const [weight, setWeight] = useState(50);
      const [reps, setReps] = useState(10);
      const [mood, setMood] = useState(2); // <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–æ —Å 3 –Ω–∞ 2 (—Å—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –∏–∑ 3)
      const [bodyWeight, setBodyWeight] = useState(70);
      const [restTimer, setRestTimer] = useState(null);
      const [restSeconds, setRestSeconds] = useState(0);
      const [isRestTimerRunning, setIsRestTimerRunning] = useState(false);
      const [showRestTimerModal, setShowRestTimerModal] = useState(false);
      const [restTimerMinutes, setRestTimerMinutes] = useState(1);
      const [restTimerSeconds, setRestTimerSeconds] = useState(30);

      useEffect(() => {
        let interval;
        if (isRestTimerRunning && restSeconds > 0) {
          interval = setInterval(() => {
            setRestSeconds(s => {
              if (s <= 1) {
                setIsRestTimerRunning(false);
                alert('‚è∞ –í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å! –ì–æ—Ç–æ–≤—ã –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–¥—Ö–æ–¥—É?');
                return 0;
              }
              return s - 1;
            });
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [isRestTimerRunning, restSeconds]);

      const addExerciseToWorkout = (exerciseId) => {
        if (!currentWorkout) return;
        
        const exercise = exercises.find(e => e.id === exerciseId);
        if (!exercise) return;

        const exists = currentWorkout.exercises.find(e => e.exerciseId === exerciseId);
        if (exists) {
          alert('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
          return;
        }

        const templateExercise = templates
          .flatMap(t => t.exercises)
          .find(e => e.exerciseId === exerciseId);
        const defaultRestTime = templateExercise?.restTime || null;

        onUpdateWorkout({
          ...currentWorkout,
          exercises: [...currentWorkout.exercises, {
            exerciseId: exercise.id,
            exerciseName: exercise.name,
            sets: [],
            restTime: defaultRestTime
          }]
        });
        setShowExerciseModal(false);
      };

      const addSet = () => {
        if (!currentWorkout || selectedExerciseId === null) return;

        const updated = {
          ...currentWorkout,
          exercises: currentWorkout.exercises.map(ex =>
            ex.exerciseId === selectedExerciseId
              ? {
                  ...ex,
                  sets: [...ex.sets, { weight, reps, mood, timestamp: Date.now() }]
                }
              : ex
          )
        };
        onUpdateWorkout(updated);
        setShowSetModal(false);
        
        const exercise = currentWorkout.exercises.find(e => e.exerciseId === selectedExerciseId);
        if (exercise?.restTime) {
          setRestSeconds(exercise.restTime);
          setIsRestTimerRunning(true);
        }
      };

      const addSetSameAsPrevious = () => {
        if (!currentWorkout || selectedExerciseId === null) return;
        const ex = currentWorkout.exercises.find(e => e.exerciseId === selectedExerciseId);
        if (!ex || ex.sets.length === 0) {
          alert('–ù–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤');
          return;
        }
        const lastSet = ex.sets[ex.sets.length - 1];
        const updated = {
          ...currentWorkout,
          exercises: currentWorkout.exercises.map(e =>
            e.exerciseId === selectedExerciseId
              ? { ...e, sets: [...e.sets, { ...lastSet, timestamp: Date.now() }] }
              : e
          )
        };
        onUpdateWorkout(updated);
        setShowSetModal(false);
        
        if (ex.restTime) {
          setRestSeconds(ex.restTime);
          setIsRestTimerRunning(true);
        }
      };

      const deleteSet = (exerciseId, setIndex) => {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–¥—Ö–æ–¥?')) return;
        if (!currentWorkout) return;
        
        const updated = {
          ...currentWorkout,
          exercises: currentWorkout.exercises.map(ex =>
            ex.exerciseId === exerciseId
              ? { ...ex, sets: ex.sets.filter((_, i) => i !== setIndex) }
              : ex
          )
        };
        onUpdateWorkout(updated);
      };

      const openSetModal = (exerciseId) => {
        setSelectedExerciseId(exerciseId);
        const exercise = currentWorkout?.exercises.find(e => e.exerciseId === exerciseId);
        if (exercise && exercise.sets.length > 0) {
          const lastSet = exercise.sets[exercise.sets.length - 1];
          setWeight(lastSet.weight);
          setReps(lastSet.reps);
          setMood(lastSet.mood);
        } else {
          setWeight(50);
          setReps(10);
          setMood(2); // <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–æ —Å 3 –Ω–∞ 2
        }
        setShowSetModal(true);
      };

      const openBodyWeightModal = (type) => {
        setBodyWeightType(type);
        const current = type === 'before' ? currentWorkout?.bodyWeightBefore : currentWorkout?.bodyWeightAfter;
        setBodyWeight(current || 70);
        setShowBodyWeightModal(true);
      };

      const saveBodyWeight = () => {
        if (!currentWorkout) return;
        if (bodyWeightType === 'before') {
          onUpdateWorkout({ ...currentWorkout, bodyWeightBefore: bodyWeight });
        } else {
          onUpdateWorkout({ ...currentWorkout, bodyWeightAfter: bodyWeight });
        }
        setShowBodyWeightModal(false);
      };

      const openRestTimerModal = (exerciseId) => {
        setSelectedExerciseId(exerciseId);
        const exercise = currentWorkout?.exercises.find(e => e.exerciseId === exerciseId);
        if (exercise?.restTime) {
          setRestTimerMinutes(Math.floor(exercise.restTime / 60));
          setRestTimerSeconds(exercise.restTime % 60);
        } else {
          setRestTimerMinutes(1);
          setRestTimerSeconds(30);
        }
        setShowRestTimerModal(true);
      };

      const saveRestTimer = () => {
        if (!currentWorkout || selectedExerciseId === null) return;
        const totalSeconds = restTimerMinutes * 60 + restTimerSeconds;
        const updated = {
          ...currentWorkout,
          exercises: currentWorkout.exercises.map(ex =>
            ex.exerciseId === selectedExerciseId
              ? { ...ex, restTime: totalSeconds }
              : ex
          )
        };
        onUpdateWorkout(updated);
        setShowRestTimerModal(false);
      };

      const startManualRestTimer = (seconds) => {
        setRestSeconds(seconds);
        setIsRestTimerRunning(true);
      };

      const stopRestTimer = () => {
        setIsRestTimerRunning(false);
        setRestSeconds(0);
      };

      /* <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è getMoodEmoji –¥–ª—è 3 —Å–º–∞–π–ª–∏–∫–æ–≤ */
      const getMoodEmoji = (m) => m === 1 ? 'üò´' : m === 3 ? 'üòÑ' : 'üòê';
      /* </CHANGE> */

      if (!currentWorkout) {
        return (
          <div className="card empty-state">
            <div className="empty-icon">üí™</div>
            <h2 className="empty-title">–ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h2>
            <p style={{marginBottom: '2rem'}}>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω</p>
            <button onClick={onStartWorkout} className="btn btn-primary btn-large">
              –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
          </div>
        );
      }


      return (
        <div>
          {isRestTimerRunning && restSeconds > 0 && (
            <div className="card" style={{background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)', border: '2px solid #fbbf24', marginBottom: '1rem'}}>
              <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
                <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                  <span style={{fontSize: '24px'}}>‚è±Ô∏è</span>
                  <div>
                    <h3 style={{fontWeight: 600, color: '#0f172a', marginBottom: '0.25rem'}}>–û—Ç–¥—ã—Ö –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏</h3>
                    <p style={{fontSize: '2rem', fontWeight: 700, color: '#f59e0b'}}>
                      {Math.floor(restSeconds / 60)}:{(restSeconds % 60).toString().padStart(2, '0')}
                    </p>
                  </div>
                </div>
                <button onClick={stopRestTimer} className="btn btn-secondary">
                  –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
              </div>
            </div>
          )}
          
          <div className="card" style={{background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)', border: '1px solid #93c5fd'}}>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1rem'}}>
              <span style={{fontSize: '20px'}}>‚öñÔ∏è</span>
              <h3 style={{fontWeight: 600, color: '#0f172a'}}>–í–µ—Å —Ç–µ–ª–∞</h3>
            </div>
            <div className="grid" style={{gridTemplateColumns: 'repeat(2, 1fr)'}}>
              <div style={{background: 'white', borderRadius: '12px', padding: '1rem'}}>
                <p style={{fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem'}}>–î–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
                {currentWorkout.bodyWeightBefore ? (
                  <p style={{fontSize: '1.5rem', fontWeight: 700, color: '#0f172a'}}>{currentWorkout.bodyWeightBefore.toFixed(1)} –∫–≥</p>
                ) : (
                  <button onClick={() => openBodyWeightModal('before')} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                    –£–∫–∞–∑–∞—Ç—å –≤–µ—Å
                  </button>
                )}
              </div>
              <div style={{background: 'white', borderRadius: '12px', padding: '1rem'}}>
                <p style={{fontSize: '0.875rem', color: '#64748b', marginBottom: '0.5rem'}}>–ü–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
                {currentWorkout.bodyWeightAfter ? (
                  <p style={{fontSize: '1.5rem', fontWeight: 700, color: '#0f172a'}}>{currentWorkout.bodyWeightAfter.toFixed(1)} –∫–≥</p>
                ) : (
                  <button onClick={() => openBodyWeightModal('after')} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                    –£–∫–∞–∑–∞—Ç—å –≤–µ—Å
                  </button>
                )}
              </div>
            </div>
          </div>

          <div className="card">
            <div className="card-header">
              <h3 style={{fontSize: '1.25rem', fontWeight: 700}}>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
              <button onClick={() => setShowExerciseModal(true)} className="btn btn-primary">
                <span>‚ûï</span> –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
              </button>
            </div>

            {currentWorkout.exercises.length === 0 ? (
              <div className="empty-state" style={{padding: '2rem 0'}}>
                <div className="empty-icon" style={{fontSize: '3rem'}}>üèãÔ∏è</div>
                <h3 className="empty-title">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
                <p>–ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É —Å –≤—ã–±–æ—Ä–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>
              </div>
            ) : (
              <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                {currentWorkout.exercises.map(ex => (
                  <div key={ex.exerciseId} className="exercise-item">
                    <div style={{marginBottom: '0.75rem'}}>
                      <h4 style={{fontWeight: 600, color: '#0f172a', marginBottom: '0.25rem'}}>{ex.exerciseName}</h4>
                      <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                        <p style={{fontSize: '0.875rem', color: '#64748b'}}>–ü–æ–¥—Ö–æ–¥–æ–≤: {ex.sets.length}</p>
                        {ex.restTime && (
                          <>
                            <span style={{color: '#94a3b8'}}>‚Ä¢</span>
                            <p style={{fontSize: '0.875rem', color: '#64748b'}}>
                              –û—Ç–¥—ã—Ö: {Math.floor(ex.restTime / 60)}:{(ex.restTime % 60).toString().padStart(2, '0')}
                            </p>
                          </>
                        )}
                      </div>
                    </div>

                    {ex.sets.length > 0 && (
                      <div style={{background: '#f8fafc', borderRadius: '8px', padding: '0.75rem', marginBottom: '0.75rem'}}>
                        {ex.sets.map((set, idx) => (
                          <div key={idx} style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: idx < ex.sets.length - 1 ? '0.5rem' : 0}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                              <span style={{fontWeight: 500, color: '#475569'}}>
                                {idx + 1}. {set.weight} –∫–≥ √ó {set.reps} –ø–æ–≤—Ç.
                              </span>
                              <span>{getMoodEmoji(set.mood)}</span>
                            </div>
                            <button onClick={() => deleteSet(ex.exerciseId, idx)} style={{background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', fontSize: '1rem'}}>
                              üóëÔ∏è
                            </button>
                          </div>
                        ))}
                      </div>
                    )}

                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                      <button onClick={() => openSetModal(ex.exerciseId)} className="btn btn-secondary" style={{fontSize: '0.875rem', flex: 1}}>
                        <span>‚ûï</span> –ü–æ–¥—Ö–æ–¥
                      </button>
                      <button onClick={() => openRestTimerModal(ex.exerciseId)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                        ‚è±Ô∏è
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="card">
            <h3 style={{fontSize: '1.125rem', fontWeight: 600, color: '#0f172a', marginBottom: '1rem'}}>–ë—ã—Å—Ç—Ä—ã–π —Ç–∞–π–º–µ—Ä –æ—Ç–¥—ã—Ö–∞</h3>
            <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
              <button onClick={() => startManualRestTimer(60)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                1 –º–∏–Ω
              </button>
              <button onClick={() => startManualRestTimer(90)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                1.5 –º–∏–Ω
              </button>
              <button onClick={() => startManualRestTimer(120)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                2 –º–∏–Ω
              </button>
              <button onClick={() => startManualRestTimer(180)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                3 –º–∏–Ω
              </button>
              <button onClick={() => startManualRestTimer(300)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                5 –º–∏–Ω
              </button>
            </div>
          </div>

          {/* <CHANGE> –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –æ—Ç–º–µ–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */}
          <div className="card">
            <div style={{display: 'flex', gap: '0.75rem', flexDirection: 'column'}}>
              <button onClick={onFinishWorkout} className="btn btn-success btn-large" style={{width: '100%'}}>
                <span>‚úÖ</span> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
              </button>
              <button onClick={onCancelWorkout} className="btn btn-warning btn-large" style={{width: '100%'}}>
                <span>‚ùå</span> –û—Ç–º–µ–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
              </button>
            </div>
          </div>
          {/* </CHANGE> */}

          {showExerciseModal && (
            <Modal onClose={() => setShowExerciseModal(false)} title="–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">
              <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem', maxHeight: '60vh', overflowY: 'auto'}}>
                {Object.entries(exerciseDatabase).map(([group, exList]) => (
                  <div key={group}>
                    <h4 style={{fontWeight: 600, color: '#475569', marginBottom: '0.5rem', marginTop: '1rem', textTransform: 'uppercase', fontSize: '0.875rem'}}>{group}</h4>
                    {exList.map(exName => {
                      const exercise = exercises.find(e => e.name === exName);
                      if (!exercise) return null;
                      return (
                        <button
                          key={exercise.id}
                          onClick={() => addExerciseToWorkout(exercise.id)}
                          className="btn btn-secondary"
                          style={{width: '100%', marginBottom: '0.5rem', justifyContent: 'flex-start'}}
                        >
                          {exercise.name}
                        </button>
                      );
                    })}
                  </div>
                ))}
              </div>
            </Modal>
          )}

          {showSetModal && (
            <Modal onClose={() => setShowSetModal(false)} title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥">
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem'}}>
                {/* <CHANGE> –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Å–∞ —Å —à–∞–≥–æ–º 2.5 –∫–≥ */}
                <div className="form-group">
                  <label className="label">–í–µ—Å (–∫–≥)</label>
                  <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                    <button 
                      onClick={() => setWeight(Math.max(0, weight - 2.5))} 
                      className="counter-btn-large"
                      type="button"
                    >
                      ‚ñº
                    </button>
                    <input 
                      type="number" 
                      step="2.5"
                      value={weight} 
                      onChange={e => setWeight(Number(e.target.value))} 
                      className="counter-input"
                      style={{flex: 1}}
                    />
                    <button 
                      onClick={() => setWeight(weight + 2.5)} 
                      className="counter-btn-large"
                      type="button"
                    >
                      ‚ñ≤
                    </button>
                  </div>
                </div>

                <div className="form-group">
                  <label className="label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</label>
                  <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                    <button 
                      onClick={() => setReps(Math.max(0, reps - 1))} 
                      className="counter-btn-large"
                      type="button"
                    >
                      ‚ñº
                    </button>
                    <input 
                      type="number" 
                      value={reps} 
                      onChange={e => setReps(Number(e.target.value))} 
                      className="counter-input"
                      style={{flex: 1}}
                    />
                    <button 
                      onClick={() => setReps(reps + 1)} 
                      className="counter-btn-large"
                      type="button"
                    >
                      ‚ñ≤
                    </button>
                  </div>
                </div>
                {/* </CHANGE> */}

                {/* <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è */}
                <div className="form-group">
                  <label className="label">–°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ</label>
                  <div style={{display: 'flex', gap: '0.5rem'}}>
                    {[1, 2, 3].map(m => (
                      <button
                        key={m}
                        onClick={() => setMood(m)}
                        type="button"
                        className="btn"
                        style={{
                          flex: 1,
                          background: mood === m ? '#2563eb' : '#f1f5f9',
                          color: mood === m ? 'white' : '#475569',
                          border: 'none',
                          fontSize: '2rem',
                          padding: '1rem'
                        }}
                      >
                        {m === 1 ? 'üò´' : m === 3 ? 'üòÑ' : 'üòê'}
                      </button>
                    ))}
                  </div>
                  <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', fontSize: '0.75rem', color: '#64748b'}}>
                    <span>–ü–ª–æ—Ö–æ</span>
                    <span>–ù–æ—Ä–º–∞–ª—å–Ω–æ</span>
                    <span>–û—Ç–ª–∏—á–Ω–æ</span>
                  </div>
                </div>
                {/* </CHANGE> */}

                <div style={{display: 'flex', gap: '0.5rem'}}>
                  <button onClick={addSet} className="btn btn-primary" style={{flex: 1}}>
                    –î–æ–±–∞–≤–∏—Ç—å
                  </button>
                  <button onClick={addSetSameAsPrevious} className="btn btn-secondary" style={{flex: 1}}>
                    –ö–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π
                  </button>
                </div>
              </div>
            </Modal>
          )}

          {showBodyWeightModal && (
            <Modal onClose={() => setShowBodyWeightModal(false)} title={`–í–µ—Å —Ç–µ–ª–∞ ${bodyWeightType === 'before' ? '–¥–æ' : '–ø–æ—Å–ª–µ'} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏`}>
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem'}}>
                <div className="form-group">
                  <label className="label">–í–µ—Å (–∫–≥)</label>
                  <input type="number" step="0.1" value={bodyWeight} onChange={e => setBodyWeight(Number(e.target.value))} className="input" />
                </div>
                <button onClick={saveBodyWeight} className="btn btn-primary">
                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
              </div>
            </Modal>
          )}

          {showRestTimerModal && (
            <Modal onClose={() => setShowRestTimerModal(false)} title="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—Ç–¥—ã—Ö–∞">
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem'}}>
                <div className="form-group">
                  <label className="label">–ú–∏–Ω—É—Ç—ã</label>
                  <input type="number" min="0" value={restTimerMinutes} onChange={e => setRestTimerMinutes(Number(e.target.value))} className="input" />
                </div>

                <div className="form-group">
                  <label className="label">–°–µ–∫—É–Ω–¥—ã</label>
                  <input type="number" min="0" max="59" value={restTimerSeconds} onChange={e => setRestTimerSeconds(Number(e.target.value))} className="input" />
                </div>

                <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                  <button onClick={() => { setRestTimerMinutes(1); setRestTimerSeconds(0); }} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                    1 –º–∏–Ω
                  </button>
                  <button onClick={() => { setRestTimerMinutes(1); setRestTimerSeconds(30); }} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                    1.5 –º–∏–Ω
                  </button>
                  <button onClick={() => { setRestTimerMinutes(2); setRestTimerSeconds(0); }} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                    2 –º–∏–Ω
                  </button>
                  <button onClick={() => { setRestTimerMinutes(3); setRestTimerSeconds(0); }} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                    3 –º–∏–Ω
                  </button>
                </div>

                <button onClick={saveRestTimer} className="btn btn-primary">
                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
              </div>
            </Modal>
          )}
        </div>
      );
    }

    function TemplatesTab({ templates, exercises, onSaveTemplate, onDeleteTemplate, onStartFromTemplate }) {
      const [showModal, setShowModal] = useState(false);
      const [showViewModal, setShowViewModal] = useState(false);
      const [editingTemplate, setEditingTemplate] = useState(null);
      const [viewingTemplate, setViewingTemplate] = useState(null);
      const [templateName, setTemplateName] = useState('');
      const [selectedExercises, setSelectedExercises] = useState(new Set());
      const [searchQuery, setSearchQuery] = useState('');
      const [exerciseRestTimes, setExerciseRestTimes] = useState({});

      const openCreateModal = () => {
        setEditingTemplate(null);
        setTemplateName('');
        setSelectedExercises(new Set());
        setSearchQuery('');
        setExerciseRestTimes({});
        setShowModal(true);
      };

      const openEditModal = (template) => {
        setEditingTemplate(template);
        setTemplateName(template.name);
        setSelectedExercises(new Set(template.exercises.map(e => e.exerciseId)));
        setSearchQuery('');
        const restTimes = {};
        template.exercises.forEach(e => {
          if (e.restTime) {
            restTimes[e.exerciseId] = e.restTime;
          }
        });
        setExerciseRestTimes(restTimes);
        setShowModal(true);
      };

      const openViewModal = (template) => {
        setViewingTemplate(template);
        setShowViewModal(true);
      };

      const saveTemplate = () => {
        if (!templateName.trim()) {
          alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏');
          return;
        }
        if (selectedExercises.size === 0) {
          alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
          return;
        }

        const template = {
          id: editingTemplate?.id || Date.now(),
          name: templateName,
          exercises: Array.from(selectedExercises).map(id => {
            const ex = exercises.find(e => e.id === id);
            return { 
              exerciseId: id, 
              exerciseName: ex.name,
              restTime: exerciseRestTimes[id] || null
            };
          }),
          createdAt: editingTemplate?.createdAt || new Date().toISOString()
        };

        onSaveTemplate(template);
        setShowModal(false);
        alert(`–®–∞–±–ª–æ–Ω ¬´${templateName}¬ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω!`);
      };

      const setRestTimeForExercise = (exerciseId) => {
        const minutes = prompt('–ú–∏–Ω—É—Ç—ã –æ—Ç–¥—ã—Ö–∞:', '1');
        const seconds = prompt('–°–µ–∫—É–Ω–¥—ã –æ—Ç–¥—ã—Ö–∞:', '30');
        if (minutes !== null && seconds !== null) {
          const totalSeconds = parseInt(minutes) * 60 + parseInt(seconds);
          setExerciseRestTimes({...exerciseRestTimes, [exerciseId]: totalSeconds});
        }
      };

      const filteredExercises = searchQuery
        ? exercises.filter(e => e.name.toLowerCase().includes(searchQuery.toLowerCase()))
        : exercises;

      const groupedExercises = {};
      filteredExercises.forEach(ex => {
        const group = ex.group || '–ü—Ä–æ—á–∏–µ';
        if (!groupedExercises[group]) groupedExercises[group] = [];
        groupedExercises[group].push(ex);
      });

      return (
        <div>
          <div className="card">
            <div className="card-header">
              <h2 className="card-title">–®–∞–±–ª–æ–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
              <button onClick={openCreateModal} className="btn btn-primary">
                <span>‚ûï</span> –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
              </button>
            </div>

            {templates.length === 0 ? (
              <div className="empty-state">
                <div className="empty-icon">üìÖ</div>
                <h3 className="empty-title">–ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤</h3>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —à–∞–±–ª–æ–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
              </div>
            ) : (
              <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                {templates.map(template => (
                  <div key={template.id} className="exercise-item">
                    <div style={{display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between', marginBottom: '0.75rem'}}>
                      <div style={{flex: 1}}>
                        <h3 style={{fontWeight: 600, fontSize: '1.125rem', color: '#0f172a', marginBottom: '0.25rem'}}>{template.name}</h3>
                        <p style={{fontSize: '0.875rem', color: '#64748b'}}>{template.exercises.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>
                      </div>
                      <button onClick={() => { if (confirm('–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω?')) { onDeleteTemplate(template.id); } }} style={{background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', fontSize: '1.25rem'}}>
                        üóëÔ∏è
                      </button>
                    </div>
                    <p style={{fontSize: '0.875rem', color: '#64748b', marginBottom: '1rem'}}>
                      {template.exercises.map(e => e.exerciseName).join(', ')}
                    </p>
                    <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                      <button onClick={() => openViewModal(template)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                        <span>üëÅÔ∏è</span> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                      </button>
                      <button onClick={() => openEditModal(template)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                        <span>‚úèÔ∏è</span> –ò–∑–º–µ–Ω–∏—Ç—å
                      </button>
                      <button onClick={() => onStartFromTemplate(template.id)} className="btn btn-success" style={{fontSize: '0.875rem', marginLeft: 'auto'}}>
                        <span>‚ñ∂Ô∏è</span> –ù–∞—á–∞—Ç—å
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {showModal && (
            <Modal onClose={() => setShowModal(false)} title={editingTemplate ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω' : '–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏'}>
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem'}}>
                <div className="form-group">
                  <label className="label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
                  <input type="text" value={templateName} onChange={e => setTemplateName(e.target.value)} placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì—Ä—É–¥—å –∏ —Ç—Ä–∏—Ü–µ–ø—Å" className="input" />
                </div>

                <div className="form-group">
                  <label className="label">–ü–æ–∏—Å–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</label>
                  <input type="text" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è..." className="input" />
                </div>

                <div className="form-group">
                  <label className="label">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
                  <div style={{maxHeight: '40vh', overflowY: 'auto', border: '1px solid #e2e8f0', borderRadius: '8px', padding: '0.75rem'}}>
                    {Object.entries(groupedExercises).map(([group, exList]) => (
                      <div key={group} style={{marginBottom: '1rem'}}>
                        <h4 style={{fontWeight: 600, color: '#475569', fontSize: '0.875rem', textTransform: 'uppercase', marginBottom: '0.5rem'}}>{group}</h4>
                        {exList.map(ex => (
                          <div key={ex.id} style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem'}}>
                            <input
                              type="checkbox"
                              checked={selectedExercises.has(ex.id)}
                              onChange={() => {
                                const updated = new Set(selectedExercises);
                                if (updated.has(ex.id)) {
                                  updated.delete(ex.id);
                                  const newRestTimes = {...exerciseRestTimes};
                                  delete newRestTimes[ex.id];
                                  setExerciseRestTimes(newRestTimes);
                                } else {
                                  updated.add(ex.id);
                                }
                                setSelectedExercises(updated);
                              }}
                              style={{width: '18px', height: '18px', cursor: 'pointer'}}
                            />
                            <label style={{flex: 1, cursor: 'pointer', fontSize: '0.875rem', color: '#0f172a'}}>
                              {ex.name}
                            </label>
                            {selectedExercises.has(ex.id) && (
                              <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                {exerciseRestTimes[ex.id] && (
                                  <span style={{fontSize: '0.75rem', color: '#64748b'}}>
                                    ‚è±Ô∏è {Math.floor(exerciseRestTimes[ex.id] / 60)}:{(exerciseRestTimes[ex.id] % 60).toString().padStart(2, '0')}
                                  </span>
                                )}
                                <button
                                  onClick={() => setRestTimeForExercise(ex.id)}
                                  style={{background: 'none', border: 'none', cursor: 'pointer', fontSize: '1rem'}}
                                  title="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –æ—Ç–¥—ã—Ö–∞"
                                >
                                  ‚è±Ô∏è
                                </button>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    ))}
                  </div>
                </div>

                <button onClick={saveTemplate} className="btn btn-primary">
                  {editingTemplate ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω'}
                </button>
              </div>
            </Modal>
          )}

          {showViewModal && viewingTemplate && (
            <Modal onClose={() => setShowViewModal(false)} title={viewingTemplate.name}>
              <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
                {viewingTemplate.exercises.map((ex, idx) => (
                  <div key={idx} style={{padding: '0.75rem', background: '#f8fafc', borderRadius: '8px'}}>
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                      <span style={{fontWeight: 500, color: '#0f172a'}}>{idx + 1}. {ex.exerciseName}</span>
                      {ex.restTime && (
                        <span style={{fontSize: '0.875rem', color: '#64748b'}}>
                          ‚è±Ô∏è {Math.floor(ex.restTime / 60)}:{(ex.restTime % 60).toString().padStart(2, '0')}
                        </span>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </Modal>
          )}
        </div>
      );
    }

    function HistoryTab({ workouts, exercises }) {
      const [expandedId, setExpandedId] = useState(null);
      const [showShareModal, setShowShareModal] = useState(false);
      const [sharingWorkout, setSharingWorkout] = useState(null);

      /* <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è getMoodEmoji –¥–ª—è 3 —Å–º–∞–π–ª–∏–∫–æ–≤ */
      const getMoodEmoji = (m) => m === 1 ? 'üò´' : m === 3 ? 'üòÑ' : 'üòê';
      /* </CHANGE> */

      const generateWorkoutShareText = (workout) => {
        const start = new Date(workout.startDate);
        const end = workout.endDate ? new Date(workout.endDate) : null;
        const duration = end ? Math.round((end.getTime() - start.getTime()) / 60000) : 0;
        const totalVolume = workout.exercises.reduce(
          (sum, ex) => sum + ex.sets.reduce((s, set) => s + set.weight * set.reps, 0),
          0
        );
        
        let text = `üí™ GymFlow - –ú–æ—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞\n\n`;
        text += `üìÖ ${start.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}\n`;
        text += `üèãÔ∏è ${workout.templateName}\n`;
        text += `‚è±Ô∏è ${duration} –º–∏–Ω\n`;
        text += `‚öñÔ∏è ${(totalVolume / 1000).toFixed(1)} —Ç–æ–Ω–Ω\n`;
        if (workout.overallMood) {
          text += `${getMoodEmoji(workout.overallMood)} –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ: ${workout.overallMood}/3\n`;
        }
        text += `\nüìã –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:\n`;
        workout.exercises.forEach((ex, idx) => {
          text += `\n${idx + 1}. ${ex.exerciseName}\n`;
          ex.sets.forEach((set, setIdx) => {
            text += `   ${setIdx + 1}. ${set.weight} –∫–≥ √ó ${set.reps} –ø–æ–≤—Ç.\n`;
          });
        });
        
        if (workout.notes) {
          text += `\nüìù –ó–∞–º–µ—Ç–∫–∏: ${workout.notes}\n`;
        }
        
        return text;
      };

      const shareWorkout = (workout) => {
        setSharingWorkout(workout);
        setShowShareModal(true);
      };

      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text).then(() => {
          alert('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }).catch(() => {
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
        });
      };

      if (workouts.length === 0) {
        return (
          <div className="card empty-state">
            <div className="empty-icon">üìà</div>
            <h3 className="empty-title">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</h3>
            <p>–ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</p>
          </div>
        );
      }

      return (
        <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
          {[...workouts].reverse().map(workout => {
            const start = new Date(workout.startDate);
            const end = workout.endDate ? new Date(workout.endDate) : null;
            const duration = end ? Math.round((end.getTime() - start.getTime()) / 60000) : 0;
            const totalSets = workout.exercises.reduce((sum, ex) => sum + ex.sets.length, 0);
            const totalVolume = workout.exercises.reduce(
              (sum, ex) => sum + ex.sets.reduce((s, set) => s + set.weight * set.reps, 0),
              0
            );

            return (
              <div key={workout.id} className="card" style={{padding: 0, overflow: 'hidden'}}>
                <button
                  onClick={() => setExpandedId(expandedId === workout.id ? null : workout.id)}
                  style={{width: '100%', padding: '1.5rem', textAlign: 'left', background: 'none', border: 'none', cursor: 'pointer'}}
                >
                  <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '0.75rem'}}>
                    <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                      <span style={{fontWeight: 600, color: '#0f172a'}}>
                        {start.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' })}
                      </span>
                      {workout.overallMood && (
                        <span style={{fontSize: '1.25rem'}}>{getMoodEmoji(workout.overallMood)}</span>
                      )}
                    </div>
                    <span style={{fontSize: '1.25rem', color: '#94a3b8', transition: 'transform 0.2s', transform: expandedId === workout.id ? 'rotate(180deg)' : 'rotate(0deg)'}}>
                      üîΩ
                    </span>
                  </div>
                  <p style={{fontSize: '0.875rem', color: '#64748b', fontWeight: 500, marginBottom: '0.5rem'}}>{workout.templateName}</p>
                  <div style={{display: 'flex', flexWrap: 'wrap', gap: '0.75rem', fontSize: '0.875rem', color: '#64748b'}}>
                    <span>{start.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</span>
                    {end && <><span>‚Ä¢</span><span>{end.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</span></>}
                    <span>‚Ä¢</span>
                    <span>{workout.exercises.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</span>
                    <span>‚Ä¢</span>
                    <span>{totalSets} –ø–æ–¥—Ö–æ–¥–æ–≤</span>
                    <span>‚Ä¢</span>
                    <span>{(totalVolume / 1000).toFixed(1)} —Ç–æ–Ω–Ω</span>
                    {duration > 0 && <><span>‚Ä¢</span><span>{duration} –º–∏–Ω</span></>}
                    {workout.bodyWeightAfter && <><span>‚Ä¢</span><span>{workout.bodyWeightAfter.toFixed(1)} –∫–≥</span></>}
                  </div>
                </button>

                {expandedId === workout.id && (
                  <div style={{padding: '0 1.5rem 1.5rem 1.5rem', borderTop: '1px solid #f1f5f9', paddingTop: '1rem', display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
                    <button onClick={() => shareWorkout(workout)} className="btn btn-primary" style={{fontSize: '0.875rem', marginBottom: '0.5rem'}}>
                      <span>üì§</span> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π
                    </button>
                    
                    {workout.exercises.map(ex => (
                      <div key={ex.exerciseId} style={{background: '#f8fafc', borderRadius: '8px', padding: '1rem'}}>
                        <h4 style={{fontWeight: 500, color: '#0f172a', marginBottom: '0.5rem'}}>{ex.exerciseName}</h4>
                        <div style={{display: 'flex', flexDirection: 'column', gap: '0.25rem'}}>
                          {ex.sets.map((set, idx) => (
                            <div key={idx} style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontSize: '0.875rem'}}>
                              <div>
                                <span style={{color: '#64748b'}}>
                                  {idx + 1}. {set.weight} –∫–≥ √ó {set.reps} –ø–æ–≤—Ç.
                                </span>
                                <span style={{fontSize: '0.75rem', color: '#94a3b8', marginLeft: '0.5rem'}}>
                                  {new Date(set.timestamp).toLocaleTimeString('ru-RU')}
                                </span>
                              </div>
                              {set.mood && <span>{getMoodEmoji(set.mood)}</span>}
                            </div>
                          ))}
                        </div>
                      </div>
                    ))}

                    {(workout.bodyWeightBefore || workout.bodyWeightAfter) && (
                      <div style={{background: '#eff6ff', borderRadius: '8px', padding: '1rem'}}>
                        <p style={{fontWeight: 500, color: '#0f172a', marginBottom: '0.25rem'}}>–í–µ—Å —Ç–µ–ª–∞:</p>
                        <p style={{fontSize: '0.875rem', color: '#64748b'}}>
                          {workout.bodyWeightBefore && `–î–æ: ${workout.bodyWeightBefore.toFixed(1)} –∫–≥`}
                          {workout.bodyWeightBefore && workout.bodyWeightAfter && ' ‚Üí '}
                          {workout.bodyWeightAfter && `–ü–æ—Å–ª–µ: ${workout.bodyWeightAfter.toFixed(1)} –∫–≥`}
                        </p>
                      </div>
                    )}
                    
                    {workout.notes && (
                      <div style={{background: '#fef3c7', borderRadius: '8px', padding: '1rem'}}>
                        <p style={{fontWeight: 500, color: '#0f172a', marginBottom: '0.5rem'}}>üìù –ó–∞–º–µ—Ç–∫–∏:</p>
                        <p style={{fontSize: '0.875rem', color: '#78350f', whiteSpace: 'pre-wrap'}}>{workout.notes}</p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            );
          })}
          
          {showShareModal && sharingWorkout && (
            <Modal onClose={() => setShowShareModal(false)} title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π">
              <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                <textarea
                  value={generateWorkoutShareText(sharingWorkout)}
                  readOnly
                  style={{
                    width: '100%',
                    minHeight: '300px',
                    padding: '1rem',
                    borderRadius: '8px',
                    border: '1px solid #e2e8f0',
                    fontSize: '0.875rem',
                    fontFamily: 'monospace',
                    resize: 'vertical'
                  }}
                />
                <button 
                  onClick={() => copyToClipboard(generateWorkoutShareText(sharingWorkout))} 
                  className="btn btn-primary"
                >
                  üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
              </div>
            </Modal>
          )}
        </div>
      );
    }

    function StatsTab({ workouts, exercises }) {
      const [selectedExerciseId, setSelectedExerciseId] = useState(null);
      const [showShareStatsModal, setShowShareStatsModal] = useState(false);

      const totalWorkouts = workouts.length;
      const totalSets = workouts.reduce((sum, w) => sum + w.exercises.reduce((s, e) => s + e.sets.length, 0), 0);
      const totalVolume = workouts.reduce(
        (sum, w) => sum + w.exercises.reduce((s, e) => s + e.sets.reduce((v, set) => v + set.weight * set.reps, 0), 0),
        0
      );
      /* <CHANGE> –ò–∑–º–µ–Ω–µ–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–ª—è —à–∫–∞–ª—ã 1-3 */
      const avgMood = workouts.filter(w => w.overallMood).length
        ? (workouts.filter(w => w.overallMood).reduce((sum, w) => sum + (w.overallMood || 0), 0) / workouts.filter(w => w.overallMood).length).toFixed(1)
        : 'N/A';
      /* </CHANGE> */
      
      const latestWeight = [...workouts].reverse().find(w => w.bodyWeightAfter)?.bodyWeightAfter || 
                           [...workouts].reverse().find(w => w.bodyWeightBefore)?.bodyWeightBefore;
      
      const totalMs = workouts.reduce((sum, w) => w.endDate ? sum + (new Date(w.endDate).getTime() - new Date(w.startDate).getTime()) : sum, 0);
      
      const totalHours = Math.floor(totalMs / 3600000);
      const totalMinutes = Math.floor((totalMs % 3600000) / 60000);
      const gymTimeDisplay = `${totalHours}—á ${totalMinutes}–º`;

      const stats = [
        { label: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', value: totalWorkouts, icon: 'üí™', gradient: 'linear-gradient(135deg, #3b82f6 0%, #4f46e5 100%)' },
        { label: '–ü–æ–¥—Ö–æ–¥–æ–≤', value: totalSets, icon: 'üìà', gradient: 'linear-gradient(135deg, #10b981 0%, #14b8a6 100%)' },
        { label: '–ü–æ–¥–Ω—è—Ç–æ —Ç–æ–Ω–Ω', value: (totalVolume / 1000).toFixed(1), icon: '‚öñÔ∏è', gradient: 'linear-gradient(135deg, #a855f7 0%, #ec4899 100%)' },
        { label: '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ', value: avgMood, icon: '‚ù§Ô∏è', gradient: 'linear-gradient(135deg, #f59e0b 0%, #f97316 100%)' },
        { label: '–í–µ—Å (–∫–≥)', value: latestWeight ? latestWeight.toFixed(1) : 'N/A', icon: '‚öñÔ∏è', gradient: 'linear-gradient(135deg, #f43f5e 0%, #dc2626 100%)' },
        { label: '–í—Ä–µ–º—è –≤ –∑–∞–ª–µ', value: gymTimeDisplay, icon: '‚è±Ô∏è', gradient: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)' },
      ];

      const generateStatsShareText = () => {
        let text = `üìä GymFlow - –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n\n`;
        text += `üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${totalWorkouts}\n`;
        text += `üìà –ü–æ–¥—Ö–æ–¥–æ–≤: ${totalSets}\n`;
        text += `‚öñÔ∏è –ü–æ–¥–Ω—è—Ç–æ —Ç–æ–Ω–Ω: ${(totalVolume / 1000).toFixed(1)}\n`;
        text += `‚è±Ô∏è –í—Ä–µ–º—è –≤ –∑–∞–ª–µ: ${gymTimeDisplay}\n`;
        if (avgMood !== 'N/A') {
          text += `‚ù§Ô∏è –°—Ä–µ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${avgMood}/3\n`;
        }
        if (latestWeight) {
          text += `üéØ –¢–µ–∫—É—â–∏–π –≤–µ—Å: ${latestWeight.toFixed(1)} –∫–≥\n`;
        }
        return text;
      };

      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text).then(() => {
          alert('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }).catch(() => {
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
        });
      };

      const exercisesWithData = exercises.filter(ex => 
        workouts.some(w => w.exercises.some(e => e.exerciseId === ex.id && e.sets.length > 0))
      );

      const getExerciseChartData = (exerciseId) => {
        const data = [];
        workouts.forEach(w => {
          const ex = w.exercises.find(e => e.exerciseId === exerciseId);
          if (ex && ex.sets.length > 0) {
            data.push({
              date: new Date(w.startDate).toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' }),
              maxWeight: Math.max(...ex.sets.map(s => s.weight)),
              volume: ex.sets.reduce((a, s) => a + s.weight * s.reps, 0) / 1000
            });
          }
        });
        return data;
      };

      const getBodyWeightData = () => {
        return workouts
          .filter(w => w.bodyWeightBefore || w.bodyWeightAfter)
          .map(w => ({
            date: new Date(w.startDate).toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' }),
            before: w.bodyWeightBefore,
            after: w.bodyWeightAfter
          }));
      };

      const getMoodData = () => {
        return workouts
          .filter(w => w.overallMood)
          .map(w => ({
            date: new Date(w.startDate).toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' }),
            mood: w.overallMood
          }));
      };

      const selectedExerciseData = selectedExerciseId ? getExerciseChartData(selectedExerciseId) : [];
      const selectedExerciseName = exercises.find(e => e.id === selectedExerciseId)?.name;
      const bodyWeightData = getBodyWeightData();
      const moodData = getMoodData();

      return (
        <div>
          <div className="card">
            <div className="card-header">
              <h2 className="card-title" style={{marginBottom: '1.5rem'}}>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
              <button onClick={() => setShowShareStatsModal(true)} className="btn btn-primary" style={{fontSize: '0.875rem'}}>
                <span>üì§</span> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
              </button>
            </div>
            
            <div className="grid" style={{marginBottom: '2rem'}}>
              {stats.map((stat, idx) => (
                <div key={idx} className="stat-card">
                  <div className="stat-icon" style={{background: stat.gradient}}>
                    {stat.icon}
                  </div>
                  <p className="stat-value">{stat.value}</p>
                  <p className="stat-label">{stat.label}</p>
                </div>
              ))}
            </div>

            {exercisesWithData.length > 0 && (
              <div className="form-group">
                <label className="label">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</label>
                <select
                  value={selectedExerciseId || ''}
                  onChange={(e) => setSelectedExerciseId(e.target.value ? Number(e.target.value) : null)}
                  className="input"
                >
                  <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ --</option>
                  {exercisesWithData.map(ex => (
                    <option key={ex.id} value={ex.id}>{ex.name}</option>
                  ))}
                </select>
              </div>
            )}

            {selectedExerciseId && selectedExerciseData.length > 0 && (
              <div className="chart-container">
                <h3 className="chart-title">{selectedExerciseName} ‚Äì –†–æ—Å—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤–µ—Å–∞</h3>
                <LineChart data={selectedExerciseData} dataKey="maxWeight" color="#4f46e5" label="–∫–≥" />
              </div>
            )}

            {selectedExerciseId && selectedExerciseData.length > 0 && (
              <div className="chart-container">
                <h3 className="chart-title">{selectedExerciseName} ‚Äì –û–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂</h3>
                <LineChart data={selectedExerciseData} dataKey="volume" color="#a855f7" label="—Ç" />
              </div>
            )}

            {bodyWeightData.length > 0 && (
              <div className="chart-container">
                <h3 className="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞ —Ç–µ–ª–∞</h3>
                <DualLineChart data={bodyWeightData} />
              </div>
            )}

            {moodData.length > 0 && (
              <div className="chart-container">
                <h3 className="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è</h3>
                <MoodChart data={moodData} />
              </div>
            )}
          </div>
          
          {showShareStatsModal && (
            <Modal onClose={() => setShowShareStatsModal(false)} title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π">
              <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                <textarea
                  value={generateStatsShareText()}
                  readOnly
                  style={{
                    width: '100%',
                    minHeight: '200px',
                    padding: '1rem',
                    borderRadius: '8px',
                    border: '1px solid #e2e8f0',
                    fontSize: '0.875rem',
                    fontFamily: 'monospace',
                    resize: 'vertical'
                  }}
                />
                <button 
                  onClick={() => copyToClipboard(generateStatsShareText())} 
                  className="btn btn-primary"
                >
                  üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
              </div>
            </Modal>
          )}
        </div>
      );
    }

    /* <CHANGE> –£–ª—É—á—à–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –∏ –ø–æ–¥–ø–∏—Å—è–º–∏ –æ—Å–µ–π */
    function LineChart({ data, dataKey, color, label }) {
      if (data.length === 0) return null;

      const maxValue = Math.max(...data.map(p => p[dataKey]));
      const minValue = Math.min(...data.map(p => p[dataKey]));
      const range = maxValue - minValue || 1;

      const yAxisLabels = [];
      for (let i = 0; i <= 4; i++) {
        yAxisLabels.push((minValue + (range * i / 4)).toFixed(1));
      }

      // –î–ª—è –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ —Ü–µ–Ω—Ç—Ä—É
      const isSinglePoint = data.length === 1;

      return (
        <div style={{
          width: '100%',
          overflowX: isSinglePoint ? 'visible' : 'auto',
          WebkitOverflowScrolling: 'touch'
        }}>
          <svg 
            viewBox="0 0 900 380" 
            style={{
              width: isSinglePoint ? '100%' : `${Math.max(600, data.length * 100)}px`,
              height: '380px',
              minWidth: '300px'
            }}
          >
            {/* –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ Y */}
            <text
              x="10"
              y="30"
              style={{fontSize: '14px', fill: '#475569', fontWeight: '600'}}
            >
              {label}
            </text>

            {/* –õ–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –∏ –º–µ—Ç–∫–∏ Y */}
            {yAxisLabels.map((labelValue, i) => (
              <g key={i}>
                <line
                  x1="70"
                  y1={320 - (i * 60)}
                  x2="870"
                  y2={320 - (i * 60)}
                  stroke="#e2e8f0"
                  strokeWidth="1"
                />
                <text
                  x="60"
                  y={325 - (i * 60)}
                  textAnchor="end"
                  style={{fontSize: '12px', fill: '#64748b', fontWeight: '500'}}
                >
                  {labelValue}
                </text>
              </g>
            ))}
            
            {isSinglePoint ? (
              <g>
                <circle cx={470} cy={320 - ((data[0][dataKey] - minValue) / range) * 240} r="8" fill={color} />
                <text
                  x={470}
                  y={320 - ((data[0][dataKey] - minValue) / range) * 240 - 20}
                  textAnchor="middle"
                  style={{fontSize: '14px', fill: '#0f172a', fontWeight: '700'}}
                >
                  {data[0][dataKey].toFixed(1)} {label}
                </text>
                <text
                  x={470}
                  y={360}
                  textAnchor="middle"
                  style={{fontSize: '12px', fill: '#64748b', fontWeight: '500'}}
                >
                  {data[0].date}
                </text>
              </g>
            ) : (
              <>
                <polyline
                  points={data.map((point, idx) => {
                    const x = 120 + (idx / (data.length - 1)) * 720;
                    const y = 320 - ((point[dataKey] - minValue) / range) * 240;
                    return `${x},${y}`;
                  }).join(' ')}
                  fill="none"
                  stroke={color}
                  strokeWidth="3"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
                
                {data.map((point, idx) => {
                  const x = 120 + (idx / (data.length - 1)) * 720;
                  const y = 320 - ((point[dataKey] - minValue) / range) * 240;
                  return (
                    <g key={idx}>
                      <circle cx={x} cy={y} r="6" fill={color} />
                      <text
                        x={x}
                        y={y - 18}
                        textAnchor="middle"
                        style={{fontSize: '13px', fill: '#0f172a', fontWeight: '700'}}
                      >
                        {point[dataKey].toFixed(1)}
                      </text>
                      <text
                        x={x}
                        y={360}
                        textAnchor="middle"
                        style={{fontSize: '11px', fill: '#64748b', fontWeight: '500'}}
                      >
                        {point.date}
                      </text>
                    </g>
                  );
                })}
              </>
            )}
          </svg>
        </div>
      );
    }

    function DualLineChart({ data }) {
      if (data.length === 0) return null;

      const allWeights = data.flatMap(p => [p.before, p.after].filter(Boolean));
      const minWeight = Math.min(...allWeights);
      const maxWeight = Math.max(...allWeights);
      const range = maxWeight - minWeight || 1;

      const yAxisLabels = [];
      for (let i = 0; i <= 4; i++) {
        yAxisLabels.push((minWeight + (range * i / 4)).toFixed(1));
      }

      const beforeData = data.filter(p => p.before);
      const afterData = data.filter(p => p.after);
      const isSinglePoint = data.length === 1;

      return (
        <div style={{
          width: '100%',
          overflowX: isSinglePoint ? 'visible' : 'auto',
          WebkitOverflowScrolling: 'touch'
        }}>
          <svg 
            viewBox="0 0 900 420" 
            style={{
              width: isSinglePoint ? '100%' : `${Math.max(600, data.length * 100)}px`,
              height: '420px',
              minWidth: '300px'
            }}
          >
            {/* –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ Y */}
            <text
              x="10"
              y="30"
              style={{fontSize: '14px', fill: '#475569', fontWeight: '600'}}
            >
              –∫–≥
            </text>

            {/* –õ–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –∏ –º–µ—Ç–∫–∏ Y */}
            {yAxisLabels.map((labelValue, i) => (
              <g key={i}>
                <line
                  x1="70"
                  y1={320 - (i * 60)}
                  x2="870"
                  y2={320 - (i * 60)}
                  stroke="#e2e8f0"
                  strokeWidth="1"
                />
                <text
                  x="60"
                  y={325 - (i * 60)}
                  textAnchor="end"
                  style={{fontSize: '12px', fill: '#64748b', fontWeight: '500'}}
                >
                  {labelValue}
                </text>
              </g>
            ))}
            
            {/* Before weight */}
            {beforeData.length === 1 ? (
              <g>
                <circle 
                  cx={470}
                  cy={320 - ((beforeData[0].before - minWeight) / range) * 240}
                  r="6" 
                  fill="#10b981" 
                />
                <text
                  x={470}
                  y={320 - ((beforeData[0].before - minWeight) / range) * 240 + 25}
                  textAnchor="middle"
                  style={{fontSize: '13px', fill: '#047857', fontWeight: '700'}}
                >
                  {beforeData[0].before.toFixed(1)}
                </text>
              </g>
            ) : beforeData.length > 1 && (
              <>
                <polyline
                  points={beforeData.map((point) => {
                    const idx = data.indexOf(point);
                    const x = 120 + (idx / (data.length - 1)) * 720;
                    const y = 320 - ((point.before - minWeight) / range) * 240;
                    return `${x},${y}`;
                  }).join(' ')}
                  fill="none"
                  stroke="#10b981"
                  strokeWidth="3"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
                {beforeData.map((point) => {
                  const idx = data.indexOf(point);
                  const x = 120 + (idx / (data.length - 1)) * 720;
                  const y = 320 - ((point.before - minWeight) / range) * 240;
                  return (
                    <g key={`before-${idx}`}>
                      <circle cx={x} cy={y} r="5" fill="#10b981" />
                      <text
                        x={x}
                        y={y + 22}
                        textAnchor="middle"
                        style={{fontSize: '12px', fill: '#047857', fontWeight: '700'}}
                      >
                        {point.before.toFixed(1)}
                      </text>
                    </g>
                  );
                })}
              </>
            )}
            
            {/* After weight */}
            {afterData.length === 1 ? (
              <g>
                <circle 
                  cx={470}
                  cy={320 - ((afterData[0].after - minWeight) / range) * 240}
                  r="6" 
                  fill="#f43f5e" 
                />
                <text
                  x={470}
                  y={320 - ((afterData[0].after - minWeight) / range) * 240 - 15}
                  textAnchor="middle"
                  style={{fontSize: '13px', fill: '#be123c', fontWeight: '700'}}
                >
                  {afterData[0].after.toFixed(1)}
                </text>
              </g>
            ) : afterData.length > 1 && (
              <>
                <polyline
                  points={afterData.map((point) => {
                    const idx = data.indexOf(point);
                    const x = 120 + (idx / (data.length - 1)) * 720;
                    const y = 320 - ((point.after - minWeight) / range) * 240;
                    return `${x},${y}`;
                  }).join(' ')}
                  fill="none"
                  stroke="#f43f5e"
                  strokeWidth="3"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeDasharray="5,5"
                />
                {afterData.map((point) => {
                  const idx = data.indexOf(point);
                  const x = 120 + (idx / (data.length - 1)) * 720;
                  const y = 320 - ((point.after - minWeight) / range) * 240;
                  return (
                    <g key={`after-${idx}`}>
                      <circle cx={x} cy={y} r="5" fill="#f43f5e" />
                      <text
                        x={x}
                        y={y - 15}
                        textAnchor="middle"
                        style={{fontSize: '12px', fill: '#be123c', fontWeight: '700'}}
                      >
                        {point.after.toFixed(1)}
                      </text>
                    </g>
                  );
                })}
              </>
            )}

            {/* –ü–æ–¥–ø–∏—Å–∏ –¥–∞—Ç */}
            {data.map((point, idx) => {
              const x = isSinglePoint ? 470 : 120 + (idx / (data.length - 1)) * 720;
              return (
                <text
                  key={idx}
                  x={x}
                  y={360}
                  textAnchor="middle"
                  style={{fontSize: '11px', fill: '#64748b', fontWeight: '500'}}
                >
                  {point.date}
                </text>
              );
            })}
          </svg>
          
          <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '0.5rem', marginTop: '1rem'}}>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <div style={{width: '20px', height: '3px', background: '#10b981'}}></div>
              <span style={{fontSize: '0.875rem', color: '#64748b'}}>–î–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</span>
            </div>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <div style={{width: '20px', height: '3px', background: '#f43f5e', borderTop: '3px dashed #f43f5e'}}></div>
              <span style={{fontSize: '0.875rem', color: '#64748b'}}>–ü–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</span>
            </div>
          </div>
        </div>
      );
    }

    function MoodChart({ data }) {
      if (data.length === 0) return null;

      /* <CHANGE> –ò–∑–º–µ–Ω–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–ª—è 3-–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª—ã */
      const isSinglePoint = data.length === 1;

      return (
        <div style={{
          width: '100%',
          overflowX: isSinglePoint ? 'visible' : 'auto',
          WebkitOverflowScrolling: 'touch'
        }}>
          <svg 
            viewBox="0 0 900 380" 
            style={{
              width: isSinglePoint ? '100%' : `${Math.max(600, data.length * 100)}px`,
              height: '380px',
              minWidth: '300px'
            }}
          >
            {/* –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ Y */}
            <text
              x="10"
              y="30"
              style={{fontSize: '14px', fill: '#475569', fontWeight: '600'}}
            >
              –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ
            </text>

            {/* –õ–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –¥–ª—è 3 —É—Ä–æ–≤–Ω–µ–π */}
            {[1, 2, 3].map(i => (
              <g key={i}>
                <line
                  x1="70"
                  y1={320 - ((i - 1) / 2) * 240}
                  x2="870"
                  y2={320 - ((i - 1) / 2) * 240}
                  stroke="#e2e8f0"
                  strokeWidth="1"
                />
                <text
                  x="60"
                  y={325 - ((i - 1) / 2) * 240}
                  textAnchor="end"
                  style={{fontSize: '12px', fill: '#64748b', fontWeight: '500'}}
                >
                  {i}
                </text>
              </g>
            ))}
            
            {isSinglePoint ? (
              <g>
                <defs>
                  <linearGradient id="moodGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style={{stopColor: '#ef4444'}} />
                    <stop offset="50%" style={{stopColor: '#facc15'}} />
                    <stop offset="100%" style={{stopColor: '#10b981'}} />
                  </linearGradient>
                </defs>
                <circle 
                  cx={470} 
                  cy={320 - ((data[0].mood - 1) / 2) * 240} 
                  r="8" 
                  fill={data[0].mood === 3 ? '#10b981' : data[0].mood === 2 ? '#facc15' : '#ef4444'} 
                />
                <text
                  x={470}
                  y={320 - ((data[0].mood - 1) / 2) * 240 - 25}
                  textAnchor="middle"
                  style={{fontSize: '24px'}}
                >
                  {data[0].mood === 1 ? 'üò´' : data[0].mood === 3 ? 'üòÑ' : 'üòê'}
                </text>
                <text
                  x={470}
                  y={360}
                  textAnchor="middle"
                  style={{fontSize: '12px', fill: '#64748b', fontWeight: '500'}}
                >
                  {data[0].date}
                </text>
              </g>
            ) : (
              <>
                <defs>
                  <linearGradient id="moodGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style={{stopColor: '#ef4444'}} />
                    <stop offset="50%" style={{stopColor: '#facc15'}} />
                    <stop offset="100%" style={{stopColor: '#10b981'}} />
                  </linearGradient>
                </defs>
                <polyline
                  points={data.map((point, idx) => {
                    const x = 120 + (idx / (data.length - 1)) * 720;
                    const y = 320 - ((point.mood - 1) / 2) * 240;
                    return `${x},${y}`;
                  }).join(' ')}
                  fill="none"
                  stroke="url(#moodGradient)"
                  strokeWidth="3"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
                
                {data.map((point, idx) => {
                  const x = 120 + (idx / (data.length - 1)) * 720;
                  const y = 320 - ((point.mood - 1) / 2) * 240;
                  const getMoodColor = (mood) => {
                    if (mood === 3) return '#10b981';
                    if (mood === 2) return '#facc15';
                    return '#ef4444';
                  };
                  return (
                    <g key={idx}>
                      <circle cx={x} cy={y} r="6" fill={getMoodColor(point.mood)} />
                      <text
                        x={x}
                        y={y - 25}
                        textAnchor="middle"
                        style={{fontSize: '22px'}}
                      >
                        {point.mood === 1 ? 'üò´' : point.mood === 3 ? 'üòÑ' : 'üòê'}
                      </text>
                      <text
                        x={x}
                        y={360}
                        textAnchor="middle"
                        style={{fontSize: '11px', fill: '#64748b', fontWeight: '500'}}
                      >
                        {point.date}
                      </text>
                    </g>
                  );
                })}
              </>
            )}
          </svg>
        </div>
      );
    }
    /* </CHANGE> */


    function AchievementsTab({ unlockedAchievements }) {
      return (
        <div className="card">
          <h2 className="card-title" style={{marginBottom: '1.5rem'}}>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
          
          {ACHIEVEMENT_CATEGORIES.map((category, catIdx) => (
            <div key={catIdx} style={{marginBottom: '2rem'}}>
              <h3 style={{fontSize: '1.25rem', fontWeight: 600, color: '#2563eb', marginBottom: '1rem', paddingBottom: '0.5rem', borderBottom: '2px solid #e2e8f0'}}>
                {category.name}
              </h3>
              <div className="achievement-grid">
                {category.achievements.map(achievement => {
                  const unlocked = unlockedAchievements.includes(achievement.id);
                  return (
                    <div
                      key={achievement.id}
                      className={`achievement-card ${unlocked ? 'unlocked' : 'locked'}`}
                    >
                      <div className={`achievement-icon ${unlocked ? '' : 'locked'}`}>
                        {achievement.icon}
                      </div>
                      <h4 className="achievement-title">{achievement.title}</h4>
                      <p className="achievement-desc">{achievement.description}</p>
                    </div>
                  );
                })}
              </div>
            </div>
          ))}
        </div>
      );
    }

    function SettingsTab({ exercises, onAddExercise, onDeleteExercise, onExportData, onImportData, onResetData }) {
      const [newExerciseName, setNewExerciseName] = useState('');
      const [newExerciseCategory, setNewExerciseCategory] = useState('');
      const [customCategory, setCustomCategory] = useState('');
      const [showLibraryModal, setShowLibraryModal] = useState(false);

      const addExercise = () => {
        const name = newExerciseName.trim();
        if (!name) {
          alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è');
          return;
        }
        if (exercises.some(e => e.name.toLowerCase() === name.toLowerCase())) {
          alert('–¢–∞–∫–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
          return;
        }
        
        const category = newExerciseCategory === 'custom' ? customCategory.trim() || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ' : newExerciseCategory || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ';
        
        onAddExercise(name, category);
        setNewExerciseName('');
        setNewExerciseCategory('');
        setCustomCategory('');
        alert(`–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ¬´${name}¬ª –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ¬´${category}¬ª!`);
      };

      const userExercises = exercises.filter(e => !e.system);
      const availableCategories = Object.keys(exerciseDatabase);

      return (
        <div>
          <div className="card">
            <h2 className="card-title" style={{marginBottom: '1.5rem'}}>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

            <div style={{display: 'flex', flexDirection: 'column', gap: '2rem'}}>
              <div>
                <h3 style={{fontSize: '1.125rem', fontWeight: 600, color: '#0f172a', marginBottom: '1rem'}}>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</h3>
                
                <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem', marginBottom: '1rem'}}>
                  <input
                    type="text"
                    value={newExerciseName}
                    onChange={e => setNewExerciseName(e.target.value)}
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è"
                    onKeyDown={e => e.key === 'Enter' && addExercise()}
                    className="input"
                  />
                  
                  <select
                    value={newExerciseCategory}
                    onChange={e => setNewExerciseCategory(e.target.value)}
                    className="input"
                  >
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    {availableCategories.map(cat => (
                      <option key={cat} value={cat}>{cat}</option>
                    ))}
                    <option value="custom">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                  </select>
                  
                  {newExerciseCategory === 'custom' && (
                    <input
                      type="text"
                      value={customCategory}
                      onChange={e => setCustomCategory(e.target.value)}
                      placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                      className="input"
                    />
                  )}
                  
                  <button onClick={addExercise} className="btn btn-primary">
                    –î–æ–±–∞–≤–∏—Ç—å
                  </button>
                </div>

                <button onClick={() => setShowLibraryModal(true)} className="btn btn-secondary" style={{marginBottom: '1rem', fontSize: '0.875rem'}}>
                  <span>üëÅÔ∏è</span> –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
                </button>

                {userExercises.length > 0 && (
                  <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                    <h4 style={{fontSize: '0.875rem', fontWeight: 600, color: '#475569', textTransform: 'uppercase', marginBottom: '0.5rem'}}>–í–∞—à–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h4>
                    {userExercises.map(ex => (
                      <div key={ex.id} style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem', background: '#f8fafc', borderRadius: '8px'}}>
                        <div>
                          <p style={{fontWeight: 500, color: '#0f172a'}}>{ex.name}</p>
                          <p style={{fontSize: '0.75rem', color: '#64748b'}}>{ex.group}</p>
                        </div>
                        <button onClick={() => onDeleteExercise(ex.id)} style={{background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', fontSize: '1.25rem'}}>
                          üóëÔ∏è
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* <CHANGE> –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö */}
              <div>
                <h3 style={{fontSize: '1.125rem', fontWeight: 600, color: '#0f172a', marginBottom: '1rem'}}>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
                  <button onClick={onExportData} className="btn btn-secondary" style={{justifyContent: 'center'}}>
                    <span>üíæ</span> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                  </button>
                  <button onClick={onImportData} className="btn btn-secondary" style={{justifyContent: 'center'}}>
                    <span>üì•</span> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                  </button>
                  <button onClick={onResetData} className="btn btn-danger" style={{justifyContent: 'center'}}>
                    <span>üóëÔ∏è</span> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                  </button>
                </div>
              </div>
              {/* </CHANGE> */}
            </div>
          </div>

          {showLibraryModal && (
            <Modal onClose={() => setShowLibraryModal(false)} title="–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π">
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem', maxHeight: '60vh', overflowY: 'auto'}}>
                {Object.entries(exerciseDatabase).map(([group, exList]) => (
                  <div key={group}>
                    <h4 style={{fontWeight: 600, color: '#475569', marginBottom: '0.75rem', textTransform: 'uppercase', fontSize: '0.875rem'}}>{group}</h4>
                    <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                      {exList.map(exName => {
                        const exercise = exercises.find(e => e.name === exName);
                        return exercise ? (
                          <div key={exercise.id} style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem', background: '#f8fafc', borderRadius: '8px'}}>
                            <span style={{color: '#475569'}}>{exercise.name}</span>
                            {!exercise.system && (
                              <button onClick={() => { onDeleteExercise(exercise.id); if (!exercises.find(e => e.id === exercise.id && !e.system)) { setShowLibraryModal(false); } }} style={{background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', fontSize: '1.125rem'}}>
                                üóëÔ∏è
                              </button>
                            )}
                          </div>
                        ) : null;
                      })}
                    </div>
                  </div>
                ))}
                {userExercises.length > 0 && (
                  <div>
                    <h4 style={{fontWeight: 600, color: '#475569', marginBottom: '0.75rem', textTransform: 'uppercase', fontSize: '0.875rem'}}>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ</h4>
                    <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                      {userExercises.map(ex => (
                        <div key={ex.id} style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem', background: '#f8fafc', borderRadius: '8px'}}>
                          <div>
                            <span style={{color: '#475569', display: 'block'}}>{ex.name}</span>
                            <span style={{fontSize: '0.75rem', color: '#94a3b8'}}>({ex.group})</span>
                          </div>
                          <button onClick={() => onDeleteExercise(ex.id)} style={{background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', fontSize: '1.125rem'}}>
                            üóëÔ∏è
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </Modal>
          )}
        </div>
      );
    }

    function Modal({ onClose, title, children }) {
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3 className="modal-title">{title}</h3>
              <button onClick={onClose} className="modal-close">‚úñÔ∏è</button>
            </div>
            <div className="modal-body">{children}</div>
          </div>
        </div>
      );
    }

    function GoalsTab({ goals, onSaveGoal, onDeleteGoal }) {
      const [showModal, setShowModal] = useState(false);
      const [editingGoal, setEditingGoal] = useState(null);
      const [goalName, setGoalName] = useState('');
      const [goalTarget, setGoalTarget] = useState('');
      const [goalCurrent, setGoalCurrent] = useState('');
      const [goalUnit, setGoalUnit] = useState('');

      const openCreateModal = () => {
        setEditingGoal(null);
        setGoalName('');
        setGoalTarget('');
        setGoalCurrent('');
        setGoalUnit('');
        setShowModal(true);
      };

      const openEditModal = (goal) => {
        setEditingGoal(goal);
        setGoalName(goal.name);
        setGoalTarget(goal.target.toString());
        setGoalCurrent(goal.current.toString());
        setGoalUnit(goal.unit);
        setShowModal(true);
      };

      const saveGoal = () => {
        if (!goalName.trim()) {
          alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏');
          return;
        }
        if (!goalTarget || isNaN(parseFloat(goalTarget))) {
          alert('–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤—É—é —Ü–µ–ª—å');
          return;
        }
        if (!goalCurrent || isNaN(parseFloat(goalCurrent))) {
          alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç');
          return;
        }

        const goal = {
          id: editingGoal?.id || Date.now(),
          name: goalName,
          target: parseFloat(goalTarget),
          current: parseFloat(goalCurrent),
          unit: goalUnit || '',
          createdAt: editingGoal?.createdAt || new Date().toISOString()
        };

        onSaveGoal(goal);
        setShowModal(false);
        alert(editingGoal ? '–¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞!' : '–¶–µ–ª—å —Å–æ–∑–¥–∞–Ω–∞!');
      };

      const updateGoalProgress = (goal) => {
        const newCurrent = prompt(`–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è "${goal.name}":\n(–°–µ–π—á–∞—Å: ${goal.current} ${goal.unit})`, goal.current.toString());
        if (newCurrent !== null && !isNaN(parseFloat(newCurrent))) {
          onSaveGoal({...goal, current: parseFloat(newCurrent)});
        }
      };

      const getProgressColor = (percentage) => {
        if (percentage >= 100) return '#10b981';
        if (percentage >= 75) return '#3b82f6';
        if (percentage >= 50) return '#f59e0b';
        return '#ef4444';
      };

      return (
        <div>
          <div className="card">
            <div className="card-header">
              <h2 className="card-title">–ú–æ–∏ —Ü–µ–ª–∏</h2>
              <button onClick={openCreateModal} className="btn btn-primary">
                <span>‚ûï</span> –ù–æ–≤–∞—è —Ü–µ–ª—å
              </button>
            </div>

            {goals.length === 0 ? (
              <div className="empty-state">
                <div className="empty-icon">üéØ</div>
                <h3 className="empty-title">–ù–µ—Ç —Ü–µ–ª–µ–π</h3>
                <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ü–µ–ª—å –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø—É—Ç—å –∫ —É—Å–ø–µ—Ö—É!</p>
              </div>
            ) : (
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem'}}>
                {goals.map(goal => {
                  const percentage = Math.min(100, (goal.current / goal.target) * 100);
                  const progressColor = getProgressColor(percentage);
                  const isCompleted = percentage >= 100;

                  return (
                    <div 
                      key={goal.id} 
                      style={{
                        background: isCompleted 
                          ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' 
                          : 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)',
                        border: `2px solid ${isCompleted ? '#10b981' : '#e2e8f0'}`,
                        borderRadius: '16px',
                        padding: '1.5rem',
                        position: 'relative',
                        overflow: 'hidden'
                      }}
                    >
                      {isCompleted && (
                        <div style={{position: 'absolute', top: '10px', right: '10px', fontSize: '2rem'}}>
                          üéâ
                        </div>
                      )}
                      
                      <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem'}}>
                        <div style={{flex: 1}}>
                          <h3 style={{fontSize: '1.5rem', fontWeight: 700, color: '#0f172a', marginBottom: '0.5rem'}}>
                            {goal.name}
                          </h3>
                          <p style={{fontSize: '1.125rem', color: '#64748b', fontWeight: 500}}>
                            {goal.current} / {goal.target} {goal.unit}
                          </p>
                        </div>
                        <button 
                          onClick={() => { if (confirm('–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å?')) { onDeleteGoal(goal.id); } }} 
                          style={{background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', fontSize: '1.5rem'}}
                        >
                          üóëÔ∏è
                        </button>
                      </div>

                      <div style={{position: 'relative', height: '32px', background: '#e2e8f0', borderRadius: '16px', overflow: 'hidden', marginBottom: '1rem'}}>
                        <div 
                          style={{
                            position: 'absolute',
                            top: 0,
                            left: 0,
                            height: '100%',
                            width: `${percentage}%`,
                            background: progressColor,
                            transition: 'width 0.5s ease',
                            borderRadius: '16px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center'
                          }}
                        >
                          {percentage > 10 && (
                            <span style={{color: 'white', fontWeight: 700, fontSize: '0.875rem'}}>
                              {percentage.toFixed(0)}%
                            </span>
                          )}
                        </div>
                        {percentage <= 10 && (
                          <span style={{position: 'absolute', right: '1rem', top: '50%', transform: 'translateY(-50%)', color: '#475569', fontWeight: 700, fontSize: '0.875rem'}}>
                            {percentage.toFixed(0)}%
                          </span>
                        )}
                      </div>

                      <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                        <button onClick={() => updateGoalProgress(goal)} className="btn btn-primary" style={{flex: 1, fontSize: '0.875rem'}}>
                          üìä –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                        </button>
                        <button onClick={() => openEditModal(goal)} className="btn btn-secondary" style={{fontSize: '0.875rem'}}>
                          ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                        </button>
                      </div>

                      {isCompleted && (
                        <div style={{marginTop: '1rem', padding: '0.75rem', background: 'rgba(16, 185, 129, 0.1)', borderRadius: '8px', textAlign: 'center'}}>
                          <p style={{color: '#10b981', fontWeight: 600, fontSize: '1rem'}}>
                            üéä –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! üéä
                          </p>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}
          </div>

          {showModal && (
            <Modal onClose={() => setShowModal(false)} title={editingGoal ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª—å' : '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å'}>
              <div style={{display: 'flex', flexDirection: 'column', gap: '1.5rem'}}>
                <div className="form-group">
                  <label className="label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                  <input 
                    type="text" 
                    value={goalName} 
                    onChange={e => setGoalName(e.target.value)} 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ñ–∏–º –ª–µ–∂–∞ 100 –∫–≥" 
                    className="input" 
                  />
                </div>

                <div className="form-group">
                  <label className="label">–¶–µ–ª–µ–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</label>
                  <input 
                    type="number" 
                    step="0.1"
                    value={goalTarget} 
                    onChange={e => setGoalTarget(e.target.value)} 
                    placeholder="100" 
                    className="input" 
                  />
                </div>

                <div className="form-group">
                  <label className="label">–¢–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</label>
                  <input 
                    type="number" 
                    step="0.1"
                    value={goalCurrent} 
                    onChange={e => setGoalCurrent(e.target.value)} 
                    placeholder="80" 
                    className="input" 
                  />
                </div>

                <div className="form-group">
                  <label className="label">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                  <input 
                    type="text" 
                    value={goalUnit} 
                    onChange={e => setGoalUnit(e.target.value)} 
                    placeholder="–∫–≥, —Ä–∞–∑, –º–∏–Ω..." 
                    className="input" 
                  />
                </div>

                <button onClick={saveGoal} className="btn btn-primary">
                  {editingGoal ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å'}
                </button>
              </div>
            </Modal>
          )}
        </div>
      );
    }

    function CalendarTab({ workouts }) {
      const [currentMonth, setCurrentMonth] = useState(new Date());

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();

        return { daysInMonth, startingDayOfWeek, year, month };
      };

      const getWorkoutDates = () => {
        const dates = new Set();
        workouts.forEach(w => {
          if (w.endDate) {
            const date = new Date(w.startDate);
            dates.add(`${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`);
          }
        });
        return dates;
      };

      const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(currentMonth);
      const workoutDates = getWorkoutDates();

      const prevMonth = () => {
        setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1));
      };

      const nextMonth = () => {
        setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1));
      };

      const isToday = (day) => {
        const today = new Date();
        return day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
      };

      const hasWorkout = (day) => {
        return workoutDates.has(`${year}-${month}-${day}`);
      };

      const getMonthStats = () => {
        const monthWorkouts = workouts.filter(w => {
          const date = new Date(w.startDate);
          return date.getMonth() === month && date.getFullYear() === year;
        });
        
        return {
          count: monthWorkouts.length,
          totalVolume: monthWorkouts.reduce(
            (sum, w) => sum + w.exercises.reduce((s, e) => s + e.sets.reduce((v, set) => v + set.weight * set.reps, 0), 0),
            0
          )
        };
      };

      const monthStats = getMonthStats();
      const weekDays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

      return (
        <div className="card">
          <div style={{marginBottom: '2rem'}}>
            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '1.5rem'}}>
              <button onClick={prevMonth} className="btn btn-secondary" style={{fontSize: '1.5rem', padding: '0.5rem 1rem'}}>
                ‚Üê
              </button>
              <h2 style={{fontSize: '1.5rem', fontWeight: 700, color: '#0f172a'}}>
                {currentMonth.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}
              </h2>
              <button onClick={nextMonth} className="btn btn-secondary" style={{fontSize: '1.5rem', padding: '0.5rem 1rem'}}>
                ‚Üí
              </button>
            </div>

            <div style={{display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem', marginBottom: '2rem'}}>
              <div style={{background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)', padding: '1rem', borderRadius: '12px'}}>
                <p style={{fontSize: '0.875rem', color: '#64748b', marginBottom: '0.25rem'}}>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –º–µ—Å—è—Ü–µ</p>
                <p style={{fontSize: '2rem', fontWeight: 700, color: '#2563eb'}}>{monthStats.count}</p>
              </div>
              <div style={{background: 'linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)', padding: '1rem', borderRadius: '12px'}}>
                <p style={{fontSize: '0.875rem', color: '#64748b', marginBottom: '0.25rem'}}>–¢–æ–Ω–Ω–∞–∂ –º–µ—Å—è—Ü–∞</p>
                <p style={{fontSize: '2rem', fontWeight: 700, color: '#a855f7'}}>{(monthStats.totalVolume / 1000).toFixed(1)} —Ç</p>
              </div>
            </div>

            <div style={{display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', marginBottom: '0.5rem'}}>
              {weekDays.map(day => (
                <div key={day} style={{textAlign: 'center', fontWeight: 600, color: '#64748b', fontSize: '0.875rem', padding: '0.5rem'}}>
                  {day}
                </div>
              ))}
            </div>

            <div style={{display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem'}}>
              {Array.from({ length: (startingDayOfWeek === 0 ? 6 : startingDayOfWeek - 1) }, (_, i) => (
                <div key={`empty-${i}`} />
              ))}
              
              {Array.from({ length: daysInMonth }, (_, i) => {
                const day = i + 1;
                const today = isToday(day);
                const workout = hasWorkout(day);

                return (
                  <div
                    key={day}
                    style={{
                      aspectRatio: '1',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      borderRadius: '12px',
                      background: workout 
                        ? 'linear-gradient(135deg, #10b981 0%, #14b8a6 100%)' 
                        : today 
                          ? '#e2e8f0' 
                          : '#f8fafc',
                      border: today ? '2px solid #2563eb' : 'none',
                      color: workout ? 'white' : '#0f172a',
                      fontWeight: workout || today ? 700 : 500,
                      fontSize: '1rem',
                      position: 'relative',
                      cursor: workout ? 'pointer' : 'default',
                      transition: 'transform 0.2s, box-shadow 0.2s',
                      boxShadow: workout ? '0 4px 12px rgba(16, 185, 129, 0.3)' : 'none'
                    }}
                    onMouseEnter={(e) => {
                      if (workout) {
                        e.currentTarget.style.transform = 'scale(1.1)';
                        e.currentTarget.style.boxShadow = '0 8px 24px rgba(16, 185, 129, 0.4)';
                      }
                    }}
                    onMouseLeave={(e) => {
                      if (workout) {
                        e.currentTarget.style.transform = 'scale(1)';
                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(16, 185, 129, 0.3)';
                      }
                    }}
                  >
                    {day}
                    {workout && (
                      <div style={{position: 'absolute', bottom: '4px', right: '4px', fontSize: '0.75rem'}}>
                        üí™
                      </div>
                    )}
                  </div>
                );
              })}
            </div>

            <div style={{marginTop: '2rem', padding: '1rem', background: '#fef3c7', borderRadius: '12px'}}>
              <p style={{fontSize: '0.875rem', color: '#78350f', textAlign: 'center'}}>
                üí° <strong>–°–æ–≤–µ—Ç:</strong> –°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏! –î–∞–∂–µ 3 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –æ—Ç–ª–∏—á–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º.
              </p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
